[{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\scripts\\capture_preview.cjs","messages":[{"ruleId":"no-undef","severity":2,"message":"'__dirname' is not defined.","line":6,"column":31,"nodeType":"Identifier","messageId":"undef","endLine":6,"endColumn":40},{"ruleId":"no-undef","severity":2,"message":"'process' is not defined.","line":9,"column":15,"nodeType":"Identifier","messageId":"undef","endLine":9,"endColumn":22},{"ruleId":"no-unused-vars","severity":2,"message":"'e' is defined but never used.","line":44,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":44,"endColumn":15},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":49,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":49,"endColumn":10},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":67,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":67,"endColumn":10},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":68,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":68,"endColumn":10},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":69,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":69,"endColumn":10},{"ruleId":"no-undef","severity":2,"message":"'console' is not defined.","line":70,"column":3,"nodeType":"Identifier","messageId":"undef","endLine":70,"endColumn":10}],"suppressedMessages":[],"errorCount":8,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"const fs = require('fs');\r\nconst path = require('path');\r\nconst { chromium } = require('playwright');\r\n\r\n(async () => {\r\n  const outDir = path.resolve(__dirname, '../.capture');\r\n  if (!fs.existsSync(outDir)) fs.mkdirSync(outDir, { recursive: true });\r\n\r\n  const url = process.argv[2] || 'http://localhost:4173/pwa_FRM_Book2_python/';\r\n  const browser = await chromium.launch({ headless: true });\r\n  const context = await browser.newContext();\r\n  const page = await context.newPage();\r\n\r\n  const consoleLogs = [];\r\n  const networkLogs = [];\r\n\r\n  page.on('console', (msg) => {\r\n    const text = `[${msg.type()}] ${msg.text()}`;\r\n    consoleLogs.push(text);\r\n  });\r\n\r\n  page.on('request', (req) => {\r\n    networkLogs.push({\r\n      type: 'request',\r\n      url: req.url(),\r\n      method: req.method(),\r\n      headers: req.headers(),\r\n      timestamp: Date.now()\r\n    });\r\n  });\r\n\r\n  page.on('response', async (res) => {\r\n    try {\r\n      const req = res.request();\r\n      networkLogs.push({\r\n        type: 'response',\r\n        url: res.url(),\r\n        status: res.status(),\r\n        statusText: res.statusText(),\r\n        requestMethod: req.method(),\r\n        headers: res.headers(),\r\n        timestamp: Date.now()\r\n      });\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  });\r\n\r\n  console.log('Navigating to', url);\r\n  await page.goto(url, { waitUntil: 'networkidle', timeout: 60000 });\r\n\r\n  // wait a bit for dynamic content\r\n  await page.waitForTimeout(1500);\r\n\r\n  const screenshotPath = path.join(outDir, 'preview_screenshot.png');\r\n  const htmlPath = path.join(outDir, 'preview_page.html');\r\n  const consolePath = path.join(outDir, 'console_log.txt');\r\n  const networkPath = path.join(outDir, 'network_log.json');\r\n\r\n  await page.screenshot({ path: screenshotPath, fullPage: true });\r\n  const html = await page.content();\r\n  fs.writeFileSync(htmlPath, html, 'utf8');\r\n\r\n  fs.writeFileSync(consolePath, consoleLogs.join('\\n'), 'utf8');\r\n  fs.writeFileSync(networkPath, JSON.stringify(networkLogs, null, 2), 'utf8');\r\n\r\n  console.log('Saved:', screenshotPath);\r\n  console.log('Saved:', htmlPath);\r\n  console.log('Saved:', consolePath);\r\n  console.log('Saved:', networkPath);\r\n\r\n  await browser.close();\r\n})();","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\scripts\\capture_preview.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":30,"column":14,"nodeType":"Identifier","messageId":"unusedVar","endLine":30,"endColumn":15},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":35,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":35,"endColumn":14,"suggestions":[{"fix":{"range":[970,1003],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":48,"column":3,"nodeType":"MemberExpression","messageId":"limited","endLine":48,"endColumn":14,"suggestions":[{"fix":{"range":[1548,1579],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":3,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs'\r\nimport path from 'path'\r\nimport { chromium } from 'playwright'\r\n\r\nconst OUT = path.resolve(process.cwd(), '.capture')\r\nif (!fs.existsSync(OUT)) fs.mkdirSync(OUT, { recursive: true })\r\n\r\nconst URL = process.argv[2] || 'http://localhost:4173/pwa_FRM_Book2_python/'\r\n;(async () => {\r\n  const browser = await chromium.launch()\r\n  const page = await browser.newPage()\r\n\r\n  const consoleLines = []\r\n  page.on('console', msg => {\r\n    consoleLines.push(`${msg.type().toUpperCase()}: ${msg.text()}`)\r\n  })\r\n\r\n  const network = []\r\n  page.on('requestfinished', async (req) => {\r\n    try {\r\n      const res = req.response()\r\n      network.push({\r\n        url: req.url(),\r\n        method: req.method(),\r\n        status: res ? res.status() : null,\r\n        headers: res ? res.headers() : {},\r\n        requestHeaders: req.headers(),\r\n        timing: res ? (res.timing ? res.timing() : null) : null\r\n      })\r\n    } catch (e) {\r\n      // ignore\r\n    }\r\n  })\r\n\r\n  console.log('navigating to', URL)\r\n  await page.goto(URL, { waitUntil: 'networkidle', timeout: 60000 })\r\n  await page.waitForTimeout(1200)\r\n\r\n  const screenshotPath = path.join(OUT, 'preview_screenshot.png')\r\n  await page.screenshot({ path: screenshotPath, fullPage: true })\r\n\r\n  const html = await page.content()\r\n  fs.writeFileSync(path.join(OUT, 'preview_page.html'), html, 'utf8')\r\n\r\n  fs.writeFileSync(path.join(OUT, 'console_log.txt'), consoleLines.join('\\n'), 'utf8')\r\n  fs.writeFileSync(path.join(OUT, 'network_log.json'), JSON.stringify(network, null, 2), 'utf8')\r\n\r\n  console.log('captured to', OUT)\r\n  await browser.close()\r\n})().catch(err => {\r\n  console.error(err)\r\n  process.exit(2)\r\n})","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\scripts\\copy_welcome_assets.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":27,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":27,"endColumn":16,"suggestions":[{"fix":{"range":[749,793],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import fs from 'fs';\r\nimport path from 'path';\r\nimport { fileURLToPath } from 'url';\r\n\r\nconst outDir = path.resolve(process.cwd(), 'public');\r\nconst __dirname = path.dirname(fileURLToPath(import.meta.url));\r\nconst srcRoot = path.resolve(__dirname, '..', '..', 'Book2_????祉移皞?FRM?沌ython蝘飛蝞⊥鞎⊿?憸券_撖行蝭?);\r\n\r\nconst files = [\r\n  {\r\n    src: path.join(srcRoot, 'FRM_Python_蝘飛蝞⊥鞎⊿?憸券_撖行蝭?jpg'),\r\n    dest: path.join(outDir, 'welcome.jpg'),\r\n  },\r\n  {\r\n    src: path.join(srcRoot, '????祉移皞?FRM?沌ython蝘飛蝞⊥鞎⊿?憸券_撖行蝭?md'),\r\n    dest: path.join(outDir, 'welcome.md'),\r\n  },\r\n];\r\n\r\nfor (const f of files) {\r\n  try {\r\n    if (!fs.existsSync(f.src)) {\r\n      console.warn(`source not found: ${f.src}`);\r\n      continue;\r\n    }\r\n    fs.copyFileSync(f.src, f.dest);\r\n    console.log(`copied ${f.src} -> ${f.dest}`);\r\n  } catch (err) {\r\n    console.error('failed to copy', f.src, err);\r\n    process.exitCode = 2;\r\n  }\r\n}\r\n\r\n// success\r\nprocess.exitCode = 0;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\App.jsx","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":195,"column":21,"nodeType":"MemberExpression","messageId":"limited","endLine":195,"endColumn":32}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useState, useEffect, lazy, Suspense } from 'react'\r\nimport TopNav from './components/TopNav'\r\nimport ContentPanel from './components/ContentPanel'\r\nconst CodePreviewPanel = lazy(() => import('./components/CodePreviewPanel'))\r\nimport PythonRunner from './components/PythonRunner'\r\nimport ReloadPrompt from './components/ReloadPrompt'\r\nimport { Book, Moon, Sun } from 'lucide-react'\r\nimport { loadPyodide, cleanupPyodide, runPythonWithTimeout, loadChapterDatasets, preloadHeavyPackages } from './utils/pyodide-loader'\r\nimport { captureAllPlots, initMatplotlib, ensurePlotsShown } from './utils/matplotlib-handler.js'\r\n\r\n// Module to package/wheel mapping for lazy loading\r\nconst MODULE_MAPPING = {\r\n  // Common scientific packages (Pyodide built-ins)\r\n  'pandas': 'pandas',\r\n  'matplotlib': 'matplotlib',\r\n  'scipy': 'scipy',\r\n  'statsmodels': 'statsmodels',\r\n  'sympy': 'sympy',\r\n  'autograd': 'autograd',\r\n  'lxml': 'lxml',\r\n  'openpyxl': 'openpyxl',\r\n  'requests': 'requests',\r\n  'sklearn': 'scikit-learn',\r\n  'scikit-learn': 'scikit-learn',\r\n  // Micropip-installable packages (from PyPI)\r\n  'arch': 'arch',\r\n  'plotly': 'plotly',\r\n  'chart_studio': 'chart-studio',\r\n  'mcint': 'mcint',\r\n  'mibian': 'mibian',\r\n  'prettytable': 'prettytable',\r\n  'qpsolvers': 'qpsolvers',\r\n  'tabulate': 'tabulate',\r\n  // Local wheel files\r\n  'numpy_financial': 'wheels/numpy_financial-1.0.0-py3-none-any.whl',\r\n  'seaborn': 'wheels/seaborn-0.13.2-py3-none-any.whl',\r\n  'pymoo': 'wheels/pymoo-0.4.1-py3-none-any.whl',\r\n  'pandas_datareader': 'wheels/pandas_datareader-0.10.0-py3-none-any.whl',\r\n  'pyodide_http': 'wheels/pyodide_http-0.2.2-py3-none-any.whl',\r\n  'mpl_toolkits': 'matplotlib',\r\n  'pylab': 'matplotlib'\r\n}\r\n\r\n// Dependencies for local wheels\r\nconst MODULE_DEPS = {\r\n  'requests': ['certifi', 'charset_normalizer', 'idna', 'urllib3'],\r\n  'certifi': 'wheels/certifi-2026.1.4-py3-none-any.whl',\r\n  'charset_normalizer': 'wheels/charset_normalizer-3.4.4-py3-none-any.whl',\r\n  'idna': 'wheels/idna-3.11-py3-none-any.whl',\r\n  'urllib3': 'wheels/urllib3-2.6.3-py3-none-any.whl'\r\n}\r\nimport { formatPythonError } from './utils/error-handler'\r\nimport { perfMonitor, reportWebVitals } from './utils/performance'\r\nimport './App.css'\r\n\r\nfunction App() {\r\n  const [pyodide, setPyodide] = useState(null)\r\n  const [loading, setLoading] = useState(true)\r\n  const [loadingProgress, setLoadingProgress] = useState(0)\r\n  const [loadingMessage, setLoadingMessage] = useState('???葉...')\r\n\r\n  // Chapter Data State\r\n  const [chapters, setChapters] = useState([])\r\n  const [chaptersLoading, setChaptersLoading] = useState(true)\r\n  const [currentChapter, setCurrentChapter] = useState(null)\r\n  const [currentScript, setCurrentScript] = useState(null)\r\n  const [selectedTopicId, setSelectedTopicId] = useState('')\r\n  const [chapterCache, setChapterCache] = useState({}) // Cache for loaded chapters\r\n\r\n  const [output, setOutput] = useState('')\r\n  const [plotImages, setPlotImages] = useState([])\r\n  const [isRunning, setIsRunning] = useState(false)\r\n  const [isInteractive, setIsInteractive] = useState(false)\r\n  const [darkMode, setDarkMode] = useState(() => {\r\n    const saved = localStorage.getItem('theme')\r\n    return saved === 'dark' || (!saved && false) // Default to Light Mode (false)\r\n  })\r\n\r\n  const [previewPanelWidth, setPreviewPanelWidth] = useState(600) // Start visible and centered\r\n  const [installedPackages] = useState(new Set())\r\n  const [currentMplBackend, setCurrentMplBackend] = useState(null)\r\n\r\n  // Fetch Chapters Index (Lightweight)\r\n  useEffect(() => {\r\n    setChaptersLoading(true)\r\n    const url = `${import.meta.env.BASE_URL}data/chapters_index.json?t=${Date.now()}`\r\n    fetch(url)\r\n      .then(res => res.json())\r\n      .then(data => {\r\n        if (data && data.length > 0) {\r\n          setChapters(data)\r\n        }\r\n        setChaptersLoading(false)\r\n      })\r\n      .catch(err => {\r\n        console.error('Failed to load chapters index:', err)\r\n        setChaptersLoading(false)\r\n      })\r\n  }, [])\r\n\r\n  const fetchChapterData = async (chapterId) => {\r\n    // Return from cache if available\r\n    if (chapterCache[chapterId]) {\r\n      return chapterCache[chapterId]\r\n    }\r\n\r\n    try {\r\n      setChaptersLoading(true)\r\n      const response = await fetch(`${import.meta.env.BASE_URL}data/chapters_${chapterId}.json?t=${Date.now()}`)\r\n      if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`)\r\n      const fullData = await response.json()\r\n\r\n      setChapterCache(prev => ({\r\n        ...prev,\r\n        [chapterId]: fullData\r\n      }))\r\n\r\n      setChaptersLoading(false)\r\n      return fullData\r\n    } catch (error) {\r\n      console.error(`Failed to load chapter ${chapterId}:`, error)\r\n      setChaptersLoading(false)\r\n      return null\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    loadPyodide((progress, message) => {\r\n      setLoadingProgress(progress)\r\n      setLoadingMessage(message)\r\n    }).then(py => {\r\n      setPyodide(py)\r\n      setLoading(false)\r\n      perfMonitor.end('pyodide-init')\r\n    })\r\n\r\n    reportWebVitals()\r\n\r\n    // Service Worker & Storage Quota Checks\r\n    const cleanups = []\r\n\r\n    if ('serviceWorker' in navigator) {\r\n      // Check for updates periodically\r\n      const updateInterval = setInterval(() => {\r\n        navigator.serviceWorker.getRegistrations().then(registrations => {\r\n          registrations.forEach(registration => registration.update())\r\n        })\r\n      }, 60 * 60 * 1000) // Check every hour\r\n\r\n      // Listen for controller change (new worker activated)\r\n      const handleControllerChange = () => {\r\n        // New Service Worker activated - no action needed\r\n      }\r\n      navigator.serviceWorker.addEventListener('controllerchange', handleControllerChange)\r\n\r\n      cleanups.push(() => {\r\n        clearInterval(updateInterval)\r\n        navigator.serviceWorker.removeEventListener('controllerchange', handleControllerChange)\r\n      })\r\n    }\r\n\r\n    if ('storage' in navigator && 'estimate' in navigator.storage) {\r\n      const checkQuota = async () => {\r\n        try {\r\n          const estimate = await navigator.storage.estimate()\r\n          if (estimate.usage && estimate.quota) {\r\n            const percentUsed = (estimate.usage / estimate.quota) * 100\r\n            if (percentUsed > 80) {\r\n              console.warn('Storage usage is high (>80%). Consider cleaning up.')\r\n            }\r\n          }\r\n        } catch (e) {\r\n          console.warn('Failed to check storage quota:', e)\r\n        }\r\n      }\r\n\r\n      // Check initially and every 5 minutes\r\n      checkQuota()\r\n      const quotaInterval = setInterval(checkQuota, 5 * 60 * 1000)\r\n\r\n      cleanups.push(() => clearInterval(quotaInterval))\r\n    }\r\n\r\n    return () => {\r\n      cleanups.forEach(fn => fn())\r\n    }\r\n  }, [])\r\n\r\n  // Background Loading for Heavy Packages\r\n  useEffect(() => {\r\n    if (pyodide && !loading) {\r\n      // Start loading heavy dependencies in the background\r\n      // This won't block the UI, but will ensure they are ready when needed later\r\n      preloadHeavyPackages(pyodide)\r\n        .then(() => console.log('Background initialization complete'))\r\n        .catch(err => console.error('Background loaded failed', err))\r\n    }\r\n  }, [pyodide, loading])\r\n\r\n  useEffect(() => {\r\n    localStorage.setItem('theme', darkMode ? 'dark' : 'light')\r\n    document.documentElement.setAttribute('data-theme', darkMode ? 'dark' : 'light')\r\n  }, [darkMode])\r\n\r\n  const ensureDependencies = async (code, isSilent = false) => {\r\n    if (!pyodide) return\r\n    const imports = code.match(/^\\s*(?:from|import)\\s+([a-zA-Z0-9_]+)/gm)\r\n    if (!imports) return\r\n\r\n    const stdLibs = ['sys', 'os', 'io', 'time', 'timeit', 'base64', 'json', 'datetime', 'math', 're', 'warnings', 'builtins', 'types', 'random', 'csv', 'copy', 'collections', 'itertools', 'functools', 'pathlib', 'fractions', 'struct', 'operator', 'string', 'decimal', 'abc', 'enum', 'typing', 'textwrap']\r\n    const coreLibs = ['numpy', 'pandas', 'matplotlib', 'scipy', 'statsmodels', 'sympy', 'lxml', 'micropip', 'js', 'builtins', 'QuantLib', 'mcint']\r\n\r\n    const neededModules = [...new Set(imports.map(line => {\r\n      const parts = line.trim().split(/\\s+/)\r\n      return parts[0] === 'from' ? parts[1].split('.')[0] : parts[1].split('.')[0]\r\n    }))].filter(mod => !stdLibs.includes(mod) && !coreLibs.includes(mod))\r\n      .filter(mod => !installedPackages.has(mod) && !window.failedPackages?.has(mod))\r\n\r\n    if (neededModules.length === 0) return\r\n\r\n    const toInstall = []\r\n    const wheelsBase = new URL(import.meta.env.BASE_URL || '/', window.location.origin).href\r\n\r\n    neededModules.forEach(mod => {\r\n      const target = MODULE_MAPPING[mod]\r\n      if (target) {\r\n        toInstall.push(target.endsWith('.whl') ? wheelsBase + target : target)\r\n        const deps = MODULE_DEPS[mod] || []\r\n        deps.forEach(dep => {\r\n          const depTarget = MODULE_DEPS[dep] || dep\r\n          toInstall.push(depTarget.endsWith('.whl') ? wheelsBase + depTarget : depTarget)\r\n        })\r\n      } else {\r\n        toInstall.push(mod)\r\n      }\r\n    })\r\n\r\n    if (toInstall.length > 0) {\r\n      try {\r\n        const uniqueInstall = [...new Set(toInstall)]\r\n        if (!isSilent) {\r\n          setOutput(prev => prev + `甇???頛??憟辣 [${neededModules.join(', ')}]...\\n`)\r\n        }\r\n\r\n        await pyodide.loadPackage('micropip')\r\n        await pyodide.runPythonAsync(`\r\nimport micropip\r\nawait micropip.install(${JSON.stringify(uniqueInstall)}, keep_going=True)\r\n        `)\r\n\r\n        if (neededModules.includes('matplotlib')) {\r\n          await initMatplotlib(pyodide)\r\n          if (!currentMplBackend) setCurrentMplBackend('AGG')\r\n        }\r\n\r\n        neededModules.forEach(mod => {\r\n          // Mark both the requested module and its mapped package as installed\r\n          installedPackages.add(mod)\r\n          const mappedPackage = MODULE_MAPPING[mod]\r\n          if (mappedPackage && !mappedPackage.endsWith('.whl')) {\r\n            installedPackages.add(mappedPackage)\r\n          }\r\n        })\r\n        if (!isSilent) {\r\n          setOutput(prev => prev + `??憟辣頛摰??\n`)\r\n        }\r\n      } catch (e) {\r\n        console.warn('Dependency loading failed:', e)\r\n        if (!window.failedPackages) window.failedPackages = new Set();\r\n        neededModules.forEach(mod => window.failedPackages.add(mod));\r\n\r\n        if (!isSilent) {\r\n          const errorMsg = e.message || String(e)\r\n          if (errorMsg.includes(\"Can't find a pure Python 3 wheel\")) {\r\n            const packageName = errorMsg.match(/for: '([^']+)'/)?.[1] || 'unknown'\r\n            setOutput(prev => prev + `?? 憟辣 \"${packageName}\" ?⊥?頛嚗?賭??舀?汗?函憓?嚗?閰衣匱蝥銵?..\\n`)\r\n          } else {\r\n            setOutput(prev => prev + `?? 憟辣頛?箇??嚗?閰衣?亙銵?..\\n`)\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  const handleRunCode = async (code) => {\r\n    if (!pyodide || isRunning || !code) return\r\n\r\n    setIsRunning(true)\r\n    setOutput('?瑁?銝?..\\n')\r\n    setPlotImages([])\r\n\r\n    try {\r\n      // 1. Detect and load missing dependencies\r\n      // Move performance timer after dependency loading to measure ACTUAL code execution\r\n      await ensureDependencies(code)\r\n      perfMonitor.start('run-code')\r\n\r\n      // Robustness: Cleanup before run\r\n      await cleanupPyodide(pyodide)\r\n\r\n      const interactive = code.includes('matplotlib.widgets') || code.includes('Slider') || code.includes('Button')\r\n      setIsInteractive(interactive)\r\n\r\n      // Optimize: Only re-init Matplotlib if backend changed or it's the first time\r\n      const targetBackend = interactive ? 'module://matplotlib_pyodide.wasm_backend' : 'AGG'\r\n      if (currentMplBackend !== targetBackend) {\r\n        // Initial AGG init is already done in pyodide-loader.js, but we ensure it here if backend changes\r\n        await initMatplotlib(pyodide, interactive)\r\n        setCurrentMplBackend(targetBackend)\r\n      }\r\n\r\n      await pyodide.runPythonAsync(`\r\nimport sys\r\nfrom io import StringIO\r\nsys.stdout = StringIO()\r\n      `)\r\n\r\n      if (interactive) {\r\n        const target = document.getElementById('pyodide-plot-container')\r\n        if (target) {\r\n          target.innerHTML = ''\r\n          window.document.pyodideMplTarget = target\r\n        }\r\n      }\r\n\r\n      try {\r\n        // Robustness: Use timeout wrapper\r\n        await runPythonWithTimeout(pyodide, code)\r\n      } catch (error) {\r\n        const partialStdout = await pyodide.runPythonAsync('sys.stdout.getvalue()')\r\n        const formattedError = formatPythonError(error)\r\n        setOutput((partialStdout ? partialStdout + '\\n' : '') + formattedError)\r\n        setIsRunning(false)\r\n        perfMonitor.end('run-code')\r\n        return\r\n      }\r\n\r\n      const stdout = await pyodide.runPythonAsync('sys.stdout.getvalue()')\r\n      setOutput(stdout || '?瑁?摰?嚗???批捆頛詨 嚗?)\r\n\r\n      if (isInteractive) {\r\n        await ensurePlotsShown(pyodide)\r\n      } else {\r\n        const images = await captureAllPlots(pyodide)\r\n        setPlotImages(images)\r\n      }\r\n\r\n    } catch (error) {\r\n      const friendlyError = formatPythonError(error)\r\n      setOutput(friendlyError)\r\n      console.error(error)\r\n    } finally {\r\n      setIsRunning(false)\r\n      perfMonitor.end('run-code')\r\n    }\r\n  }\r\n\r\n  const handleChapterSelect = async (chapterMeta) => {\r\n    // chapterMeta might be just the index item (id, title, number) OR full data if cached/monolith\r\n    // We need to ensure we have the full data (content, examples)\r\n\r\n    let fullChapter = chapterMeta\r\n\r\n    // If it's a lightweight index item (no 'content' property), fetch full data\r\n    if (chapterMeta && !chapterMeta.content) {\r\n      fullChapter = await fetchChapterData(chapterMeta.id)\r\n    }\r\n\r\n    if (!fullChapter) return // Error or loading failed\r\n\r\n    setCurrentChapter(fullChapter)\r\n    setCurrentScript(null)\r\n    setSelectedTopicId('') // Reset topic when chapter changes\r\n    setOutput('')\r\n    setPlotImages([])\r\n\r\n    // Predictive Load: Scan all examples in the chapter for dependencies and trigger background load\r\n    if (fullChapter && fullChapter.examples && pyodide) {\r\n      const allCode = fullChapter.examples.map(ex => ex.code).join('\\n')\r\n      ensureDependencies(allCode, true) // Silent background load\r\n    }\r\n  }\r\n\r\n  // Lazy Load Datasets for Current Chapter\r\n  useEffect(() => {\r\n    if (pyodide && currentChapter && currentChapter.id) {\r\n      loadChapterDatasets(pyodide, currentChapter.id)\r\n        .catch(err => console.error(\"Dataset lazy load failed\", err))\r\n    }\r\n  }, [pyodide, currentChapter])\r\n\r\n  const handleCodeClick = (script) => {\r\n    setCurrentScript(script)\r\n    setOutput('')\r\n    setPlotImages([])\r\n  }\r\n\r\n  const handleScriptSelect = (script) => {\r\n    setCurrentScript(script)\r\n    setOutput('')\r\n    setPlotImages([])\r\n  }\r\n\r\n  const handleClosePreview = () => {\r\n    setCurrentScript(null)\r\n    setOutput('')\r\n    setPlotImages([])\r\n  }\r\n\r\n  const isLoadingEnvironment = loading;\r\n\r\n  return (\r\n    <div className={`app ${darkMode ? 'dark' : ''}`}>\r\n      <div className=\"main-content\">\r\n        <div className=\"top-bar\">\r\n          <div className=\"top-bar-left\">\r\n            <Book size={20} className=\"logo-icon\" />\r\n            <span className=\"app-title\">FRM_Book2 (撖行蝭?</span>\r\n          </div>\r\n\r\n          <TopNav\r\n            chapters={chapters}\r\n            currentChapter={currentChapter}\r\n            onChapterSelect={handleChapterSelect}\r\n            currentScript={currentScript}\r\n            onScriptSelect={handleScriptSelect}\r\n            selectedTopicId={selectedTopicId}\r\n            onTopicSelect={setSelectedTopicId}\r\n            loading={chaptersLoading}\r\n          />\r\n\r\n          <div className=\"top-bar-right\">\r\n            <button\r\n              className=\"theme-toggle\"\r\n              onClick={() => setDarkMode(!darkMode)}\r\n              title={darkMode ? '???唬漁?脫芋撘? : '???唳??脫芋撘?}\r\n            >\r\n              {darkMode ? <Sun size={20} /> : <Moon size={20} />}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n\r\n\r\n        {/* Premium Hydration Dashboard (Center Overlay) */}\r\n        {isLoadingEnvironment && (\r\n          <div className=\"hydration-overlay\">\r\n            <div className=\"hydration-card\">\r\n              <div className=\"hydration-header\">\r\n                <div className=\"hydration-title\">FRM Python 撘???銝?/div>\r\n                <div className=\"hydration-subtitle\">Financial Risk Management</div>\r\n              </div>\r\n\r\n              <div className=\"hydration-progress-container\">\r\n                <div className=\"hydration-progress-bar\" style={{ width: `${loadingProgress}%` }}></div>\r\n              </div>\r\n\r\n              <div className=\"hydration-status\">\r\n                <span>{loadingMessage}</span>\r\n                <span>{loadingProgress}%</span>\r\n              </div>\r\n            </div>\r\n          </div>\r\n        )}\r\n\r\n        <div className=\"panes-container\">\r\n          <div className=\"content-pane\">\r\n            <ContentPanel\r\n              chapter={currentChapter}\r\n              onCodeClick={handleCodeClick}\r\n              selectedTopicId={selectedTopicId}\r\n              darkMode={darkMode}\r\n              output={output}\r\n              isRunning={isRunning}\r\n              plotImages={plotImages}\r\n              onClearOutput={() => {\r\n                setOutput('')\r\n                setPlotImages([])\r\n              }}\r\n            />\r\n          </div>\r\n\r\n          {currentScript && (\r\n            <div className=\"preview-pane\" style={{ width: `${previewPanelWidth}px` }}>\r\n              <Suspense fallback={<div style={{ display: 'flex', justifyContent: 'center', alignItems: 'center', height: '100%', color: '#888' }}>Loading Editor...</div>}>\r\n                <CodePreviewPanel\r\n                  script={currentScript}\r\n                  onClose={handleClosePreview}\r\n                  onRun={handleRunCode}\r\n                  isRunning={isRunning}\r\n                  isLoading={loading}\r\n                  output={output}\r\n                  images={plotImages}\r\n                  isInteractive={isInteractive}\r\n                  darkMode={darkMode}\r\n                  width={previewPanelWidth}\r\n                  onResize={setPreviewPanelWidth}\r\n                />\r\n              </Suspense>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n\r\n      <PythonRunner pyodide={pyodide} />\r\n      <ReloadPrompt />\r\n    </div>\r\n  )\r\n}\r\n\r\nexport default App\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\ChapterNav.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\CodeEditor.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\CodePreviewPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\ContentPanel.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'_' is defined but never used.","line":65,"column":42,"nodeType":"Identifier","messageId":"unusedVar","endLine":65,"endColumn":43,"suggestions":[{"messageId":"removeVar","data":{"varName":"_"},"fix":{"range":[2898,2899],"text":""},"desc":"Remove unused variable '_'."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":1,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useEffect, useMemo, memo } from 'react'\r\nimport { Marked } from 'marked'\r\nimport markedKatex from 'marked-katex-extension'\r\nimport DOMPurify from 'dompurify'\r\nimport './ContentPanel.css'\r\nimport './WelcomeScreen.css'\r\n\r\n// Configure KaTeX extension with proper delimiters\r\n// Create a dedicated Marked instance to avoid global state pollution and HMR issues\r\nconst marked = new Marked(\r\n  markedKatex({\r\n    throwOnError: false,\r\n    output: 'html',\r\n    nonStandard: true // Ensure $ delimiters are enabled\r\n  })\r\n)\r\n\r\nconst ContentPanel = memo(({ chapter, onCodeClick, selectedTopicId, output, isRunning, plotImages }) => {\r\n  // Use useMemo to prevent expensive markdown parsing on every re-render (like when resizing)\r\n  const renderedContent = useMemo(() => {\r\n    if (!chapter) return null\r\n\r\n    const intro = chapter.content?.intro\r\n    if (intro) {\r\n      let rawMarkdown = \"\"\r\n\r\n      if (typeof intro === 'string') {\r\n        rawMarkdown = intro\r\n      } else if (typeof intro === 'object') {\r\n        // Reconstruct markdown from structured object\r\n        rawMarkdown = `# ${intro.title || ''}\\n\\n`\r\n\r\n        // Roadmap\r\n        if (intro.roadmap) {\r\n          if (intro.roadmap.guide) rawMarkdown += `## ?? 蝡?撠汗\\n${intro.roadmap.guide}\\n\\n`\r\n          if (intro.roadmap.objectives) rawMarkdown += `## ? 摮貊??格?\\n${intro.roadmap.objectives}\\n\\n`\r\n          if (intro.roadmap.topics) rawMarkdown += `## ?? 蝡?????\\n${intro.roadmap.topics}\\n\\n`\r\n        }\r\n\r\n        // Value\r\n        if (intro.value) {\r\n          if (intro.value.practical) rawMarkdown += `## ? FRM ?岫?祕???\\n${intro.value.practical}\\n\\n`\r\n          if (intro.value.theory) rawMarkdown += `## ??儭?鞎⊿???瘛勗漲閫??\\n${intro.value.theory}\\n\\n`\r\n          if (intro.value.further_reading) rawMarkdown += `## ?? 撱嗡撓?梯??脤?霅圈?\\n${intro.value.further_reading}\\n\\n`\r\n        }\r\n\r\n        // Implementation\r\n        if (intro.implementation) {\r\n          if (intro.implementation.python) rawMarkdown += `## ?? Python 撖西??孵墦\n${intro.implementation.python}\\n\\n`\r\n          if (intro.implementation.logic) rawMarkdown += `## ?? 隞?Ⅳ?詨??摩\\n${intro.implementation.logic}\\n\\n`\r\n          if (intro.implementation.scenarios) rawMarkdown += `## ? ??湔皜\\n${intro.implementation.scenarios}\\n\\n`\r\n        }\r\n\r\n        // Detailed Content (from content.body)\r\n        const bodyContent = chapter.content?.body || intro.body\r\n        if (bodyContent) {\r\n          rawMarkdown += `\\n## ?? 蝡???閫?牧 ( ?批捆?婢I?Ｙ?嚗???祆?靘?)\\n`\r\n          if (typeof bodyContent === 'string') {\r\n            rawMarkdown += bodyContent\r\n          } else if (Array.isArray(bodyContent)) {\r\n            rawMarkdown += bodyContent.join('\\n\\n')\r\n          } else if (typeof bodyContent === 'object') {\r\n            // Order entries logically (e.g., numerically by key if possible)\r\n            const entries = Object.entries(bodyContent)\r\n            rawMarkdown += entries.map(([_, content]) => content).join('\\n\\n')\r\n          }\r\n        }\r\n      }\r\n\r\n      // Hide Scenarios from main flow as they might be handled differently or just kept here\r\n      rawMarkdown = rawMarkdown.replace(\r\n        /##\\s*?\\s*??湔皜[\\s\\S]*?(?=##|$)/g,\r\n        ''\r\n      )\r\n\r\n      // Pre-process for KaTeX: Ensure proper spacing around math delimiters\r\n      rawMarkdown = rawMarkdown\r\n        .replace(/\\s*\\$\\$\\s*/g, '\\n$$\\n')\r\n\r\n      let rawHtml = marked.parse(rawMarkdown)\r\n\r\n      // Inject IDs into <h3> tags for anchoring\r\n      rawHtml = rawHtml.replace(/<h3>(.*?)<\\/h3>/g, (match, title) => {\r\n        const textOnly = title.replace(/<[^>]*>/g, '').trim()\r\n        const id = 'topic-' + textOnly.replace(/\\s+/g, '-').toLowerCase()\r\n        return `<h3 id=\"${id}\">${title}</h3>`\r\n      })\r\n\r\n      const cleanHtml = DOMPurify.sanitize(rawHtml, {\r\n        ADD_TAGS: [\r\n          'math', 'annotation', 'semantics', 'mrow', 'msub', 'msup', 'msubsup', 'mover', 'munder', 'munderover',\r\n          'mmultiscripts', 'mprec', 'mnext', 'mtable', 'mtr', 'mtd', 'mfrac', 'msqrt', 'mroot', 'mstyle', 'merror',\r\n          'mpadded', 'mphantom', 'mfenced', 'menclose', 'ms', 'mglyph', 'maligngroup', 'malignmark', 'maction',\r\n          'svg', 'path', 'use', 'span', 'div'\r\n        ],\r\n        ADD_ATTR: ['id', 'target', 'xlink:href', 'class', 'style', 'aria-hidden', 'viewBox', 'd', 'fill', 'stroke', 'stroke-width', 'data-filename']\r\n      })\r\n\r\n      let processedHtml = cleanHtml\r\n      const scripts = chapter.examples || []\r\n      const sortedScripts = [...scripts].sort((a, b) => b.filename.length - a.filename.length)\r\n\r\n      sortedScripts.forEach((script) => {\r\n        const escapedName = script.filename.replace('.', '\\\\.')\r\n        const regex = new RegExp(`(?<!['\".\\\\w])(${escapedName})(?!['\".\\\\w])`, 'g')\r\n\r\n        processedHtml = processedHtml.replace(\r\n          regex,\r\n          `<span class=\"code-link\" data-filename=\"${script.filename}\">${script.filename}</span>`\r\n        )\r\n      })\r\n\r\n      return processedHtml\r\n    } else {\r\n      const examples = chapter.examples || []\r\n      let html = `\r\n        <div class=\"chapter-intro\">\r\n          <h2>${chapter.title}</h2>\r\n          <p>?祉?? ${examples.length} ??撘?靘?/p>\r\n          <div class=\"example-grid\">\r\n      `\r\n\r\n      examples.forEach((example, index) => {\r\n        html += `\r\n          <div class=\"example-card\">\r\n            <div class=\"example-number\">${index + 1}</div>\r\n            <div class=\"example-info\">\r\n              <h3>${example.title}</h3>\r\n              <span class=\"code-link\" data-filename=\"${example.filename}\">${example.filename}</span>\r\n            </div>\r\n          </div>\r\n        `\r\n      })\r\n\r\n      html += `\r\n          </div>\r\n        </div>\r\n      `\r\n      return html\r\n    }\r\n  }, [chapter])\r\n\r\n  useEffect(() => {\r\n    const handleCodeLinkClick = (e) => {\r\n      if (e.target.classList.contains('code-link')) {\r\n        const filename = e.target.dataset.filename\r\n        let script = null\r\n\r\n        if (chapter?.examples) {\r\n          script = chapter.examples.find(s => s.filename === filename)\r\n          if (script && !script.metadata) {\r\n            script.metadata = { description: script.title }\r\n          }\r\n        }\r\n\r\n        if (script) {\r\n          onCodeClick(script)\r\n        }\r\n      }\r\n    }\r\n\r\n    document.addEventListener('click', handleCodeLinkClick)\r\n    return () => document.removeEventListener('click', handleCodeLinkClick)\r\n  }, [chapter, onCodeClick])\r\n\r\n  // Auto-scroll to top when chapter changes\r\n  useEffect(() => {\r\n    const scrollContainer = document.querySelector('.content-scroll')\r\n    if (scrollContainer) {\r\n      scrollContainer.scrollTop = 0\r\n    }\r\n  }, [chapter])\r\n\r\n  // Auto-scroll to topic when selectedTopicId changes\r\n  useEffect(() => {\r\n    if (selectedTopicId) {\r\n      const element = document.getElementById(selectedTopicId)\r\n      if (element) {\r\n        element.scrollIntoView({ behavior: 'smooth', block: 'start' })\r\n      }\r\n    }\r\n  }, [selectedTopicId])\r\n\r\n  // Auto-scroll to top when output result appears\r\n  useEffect(() => {\r\n    if (output || (plotImages && plotImages.length > 0) || isRunning) {\r\n      const scrollContainer = document.querySelector('.content-scroll')\r\n      if (scrollContainer) {\r\n        // Use scrollTo for smooth or instant reset\r\n        scrollContainer.scrollTo({ top: 0, behavior: 'instant' })\r\n      }\r\n    }\r\n  }, [output, plotImages, isRunning])\r\n\r\n  return (\r\n    <div className=\"content-panel\">\r\n      <div className=\"content-scroll\">\r\n        {/* We keep Markdown content ALWAYS rendered if it exists, \r\n            but hide it when output is shown to maintain scroll position if needed,\r\n            OR just exclusive view as before but now memoized. */}\r\n        {(output || (plotImages && plotImages.length > 0) || isRunning) ? (\r\n          <div id=\"execution-output\" className=\"execution-output-section\">\r\n            {isRunning && (\r\n              <div className=\"running-indicator\">\r\n                <div className=\"spinner\"></div>\r\n                <span>蝔??瑁?銝?..</span>\r\n              </div>\r\n            )}\r\n\r\n            {output && (\r\n              <pre className=\"output-text\">{output}</pre>\r\n            )}\r\n\r\n            {plotImages && plotImages.length > 0 && (\r\n              <div className=\"output-images\">\r\n                {plotImages.map((img, index) => (\r\n                  <div key={index} className=\"output-image\">\r\n                    <img src={img} alt={`Plot ${index + 1}`} />\r\n                  </div>\r\n                ))}\r\n              </div>\r\n            )}\r\n          </div>\r\n        ) : (\r\n          renderedContent ? (\r\n            <div\r\n              className=\"markdown-body\"\r\n              dangerouslySetInnerHTML={{ __html: renderedContent }}\r\n            />\r\n          ) : (\r\n            <div className=\"welcome-screen\">\r\n              <div className=\"welcome-card premium-welcome\">\r\n                <div className=\"welcome-brand\">\r\n                  <img src=\"welcome.jpg\" alt=\"FRM Python ???祕?豹" className=\"welcome-book-img\" />\r\n                  <a\r\n                    href=\"https://deepwisdom.com.tw/product/%e6%89%8b%e8%a1%93%e5%88%80%e8%88%ac%e7%b2%be%e6%ba%96%e7%9a%84frm-%e7%94%a8python%e7%a7%91%e5%ad%b8%e7%ae%a1%e6%8e%a7%e8%b2%a1%e9%87%91%e9%a2%a8%e9%9a%aa%e5%af%a6%e6%88%b0%e7%af%87dm2308/\"\r\n                    target=\"_blank\"\r\n                    rel=\"noopener noreferrer\"\r\n                    className=\"welcome-purchase-btn\"\r\n                  >\r\n                    [ ?祆摰雯鞈潸眺??? ]\r\n                  </a>\r\n                </div>\r\n                <div className=\"welcome-content\">\r\n                  <h2 className=\"welcome-title\">Python ??憸券蝞∠?嚗?br />?詨飛璅∪?????(撖行蝭?</h2>\r\n                  <div className=\"welcome-slogan\">??????憒?銵??祉移皞??拍Python撟思?蝞⊥鞎⊿?憸券嚗?????/div>\r\n\r\n                  <div className=\"welcome-text-scroll\">\r\n                    <p>?其?銝?砍蝷??飛蝧????賢??沌ython蝔?隤??虜?函?撌亙憟辣銋?嚗銝?撠望??撠??◢?芷脰?閰摯鈭?/p>\r\n                    <p>?祆?亦?隞晶鈭?蝔格摮豢芋???瘜Ｗ??扼璈?蝔??貊???收?臬井???收銝?整璈憤甇乓雁蝝?蝔?嚗憭????∠?蝑摮豢芋?????/p>\r\n                    <p>?絞閮?摮訾葉?撣貊??甇賂??祆銋?瘨?憭??砌?鈭?璅嫘SM?豢?甈???瘥?撣憸券蝑??賣??摰?ython蝔??摮詨撘?霈??蝞??具?/p>\r\n                    <p>????樴之銝????閬?雿輻????祉移皞敦蝺餃?瘥??敦蝭嚗蝡??Ｖ?鈭?嚗?颲行???啣之?斤?餈郭??韏啣嚗??臭?憭扳?憭晞?/p>\r\n                  </div>\r\n                </div>\r\n              </div>\r\n            </div>\r\n          )\r\n        )}\r\n      </div>\r\n    </div>\r\n  )\r\n})\r\n\r\nexport default ContentPanel\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\FloatingOutput.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\LoadingProgress.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\OutputPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\PythonRunner.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\ReloadPrompt.jsx","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'useState' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":18,"suggestions":[{"messageId":"removeVar","data":{"varName":"useState"},"fix":{"range":[69,78],"text":""},"desc":"Remove unused variable 'useState'."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'useEffect' is defined but never used.","line":2,"column":20,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":29,"suggestions":[{"messageId":"removeVar","data":{"varName":"useEffect"},"fix":{"range":[77,88],"text":""},"desc":"Remove unused variable 'useEffect'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":12,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":12,"endColumn":24,"suggestions":[{"fix":{"range":[388,430],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":20,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":20,"endColumn":24,"suggestions":[{"fix":{"range":[664,707],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":4,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useRegisterSW } from 'virtual:pwa-register/react'\r\nimport { useState, useEffect } from 'react'\r\nimport './ReloadPrompt.css'\r\n\r\nfunction ReloadPrompt() {\r\n    const {\r\n        offlineReady: [offlineReady, setOfflineReady],\r\n        needRefresh: [needRefresh, setNeedRefresh],\r\n        updateServiceWorker,\r\n    } = useRegisterSW({\r\n        onRegisteredSW(swUrl, r) {\r\n            console.log(`Service Worker at: ${swUrl}`)\r\n            if (r) {\r\n                setInterval(() => {\r\n                    r.update()\r\n                }, 60 * 60 * 1000) // Check for updates every hour\r\n            }\r\n        },\r\n        onRegisterError(error) {\r\n            console.log('SW registration error', error)\r\n        },\r\n    })\r\n\r\n    const close = () => {\r\n        setOfflineReady(false)\r\n        setNeedRefresh(false)\r\n    }\r\n\r\n    // Auto-update if configured (optional, but safer to prompt user)\r\n    // useEffect(() => {\r\n    //   if (needRefresh) {\r\n    //     console.log('New content available, auto-updating...')\r\n    //     updateServiceWorker(true)\r\n    //   }\r\n    // }, [needRefresh])\r\n\r\n    return (\r\n        <div className=\"ReloadPrompt-container\">\r\n            {(offlineReady || needRefresh) && (\r\n                <div className=\"ReloadPrompt-toast\">\r\n                    <div className=\"ReloadPrompt-message\">\r\n                        {offlineReady\r\n                            ? 'App ready to work offline'\r\n                            : 'New content available, click on reload button to update.'}\r\n                    </div>\r\n                    {needRefresh && (\r\n                        <button className=\"ReloadPrompt-toast-button\" onClick={() => updateServiceWorker(true)}>\r\n                            Reload\r\n                        </button>\r\n                    )}\r\n                    <button className=\"ReloadPrompt-toast-button\" onClick={close}>\r\n                        Close\r\n                    </button>\r\n                </div>\r\n            )}\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default ReloadPrompt\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\Skeleton.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\TopNav.jsx","messages":[{"ruleId":"no-unsafe-optional-chaining","severity":2,"message":"Unsafe usage of optional chaining. If it short-circuits with 'undefined' the evaluation will throw TypeError.","line":114,"column":148,"nodeType":"ChainExpression","messageId":"unsafeOptionalChain","endLine":114,"endColumn":180}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"source":"import { useMemo } from 'react'\r\nimport { ChevronDown } from 'lucide-react'\r\nimport './TopNav.css'\r\n\r\nfunction TopNav({\r\n    chapters,\r\n    currentChapter,\r\n    onChapterSelect,\r\n    currentScript,\r\n    onScriptSelect,\r\n    selectedTopicId,\r\n    onTopicSelect,\r\n    loading,\r\n\r\n}) {\r\n    // Extract H3 topics for the dropdown\r\n    const topics = useMemo(() => {\r\n        const intro = currentChapter?.content?.intro\r\n        if (!intro) return []\r\n\r\n        let targetText = \"\"\r\n        if (typeof intro === 'string') {\r\n            targetText = intro\r\n        } else if (typeof intro === 'object' && intro.body) {\r\n            if (typeof intro.body === 'string') {\r\n                targetText = intro.body\r\n            } else if (Array.isArray(intro.body)) {\r\n                targetText = intro.body.join('\\n')\r\n            } else {\r\n                // Handle object with numeric/string keys\r\n                targetText = Object.values(intro.body).join('\\n')\r\n            }\r\n        } else {\r\n            return []\r\n        }\r\n\r\n        const h3Regex = /^###\\s+(.+)$/gm\r\n        const matches = []\r\n        let match\r\n        while ((match = h3Regex.exec(targetText)) !== null) {\r\n            const title = match[1].trim()\r\n            // Generic ID based on title for anchoring\r\n            const id = 'topic-' + title.replace(/\\s+/g, '-').toLowerCase()\r\n            matches.push({ id, title })\r\n        }\r\n        return matches\r\n    }, [currentChapter])\r\n\r\n    return (\r\n        <div className=\"top-nav-container\">\r\n            {/* Chapter Dropdown */}\r\n            <div className=\"nav-group\">\r\n                <div className=\"custom-select-wrapper\">\r\n                    <select\r\n                        id=\"chapter-select\"\r\n                        name=\"chapter-select\"\r\n                        value={currentChapter?.id || ''}\r\n                        onChange={(e) => {\r\n                            const ch = chapters.find(c => c.id === e.target.value)\r\n                            if (ch) onChapterSelect(ch)\r\n                        }}\r\n                        disabled={loading || chapters.length === 0}\r\n                        className=\"custom-select\"\r\n                    >\r\n                        <option value=\"\" disabled>\r\n                            {loading ? '頛銝?..' : '?? 蝡??豢?'}\r\n                        </option>\r\n                        {chapters.map(ch => (\r\n                            <option key={ch.id} value={ch.id}>\r\n                                {ch.title}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                    <ChevronDown className=\"select-icon\" size={16} />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Topic Dropdown (H3 Anchors) */}\r\n            <div className={`nav-group ${!currentChapter || topics.length === 0 ? 'disabled' : ''}`}>\r\n                <div className=\"custom-select-wrapper\">\r\n                    <select\r\n                        id=\"topic-select\"\r\n                        name=\"topic-select\"\r\n                        value={selectedTopicId}\r\n                        onChange={(e) => onTopicSelect(e.target.value)}\r\n                        disabled={!currentChapter || topics.length === 0}\r\n                        className=\"custom-select\"\r\n                    >\r\n                        <option value=\"\">? ??撠汗</option>\r\n                        {topics.map(topic => (\r\n                            <option key={topic.id} value={topic.id}>\r\n                                {topic.title}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                    <ChevronDown className=\"select-icon\" size={16} />\r\n                </div>\r\n            </div>\r\n\r\n            {/* Script Dropdown (Only if chapter selected) */}\r\n            <div className={`nav-group ${!currentChapter ? 'disabled' : ''}`}>\r\n                <div className=\"custom-select-wrapper\">\r\n                    <select\r\n                        id=\"script-select\"\r\n                        name=\"script-select\"\r\n                        value={currentScript?.filename || ''}\r\n                        onChange={(e) => {\r\n                            const examples = currentChapter?.examples || currentChapter?.content?.examples\r\n                            if (examples) {\r\n                                const script = examples.find(s => s.filename === e.target.value)\r\n                                if (script) onScriptSelect(script)\r\n                            }\r\n                        }}\r\n                        disabled={!currentChapter || !(currentChapter.examples || currentChapter.content?.examples) || (currentChapter.examples || currentChapter.content?.examples).length === 0}\r\n                        className=\"custom-select\"\r\n                    >\r\n                        <option value=\"\" disabled>? 蝔?隞?Ⅳ</option>\r\n                        {(currentChapter?.examples || currentChapter?.content?.examples)?.map(ex => (\r\n                            <option key={ex.filename} value={ex.filename}>\r\n                                {ex.filename}\r\n                            </option>\r\n                        ))}\r\n                    </select>\r\n                    <ChevronDown className=\"select-icon\" size={16} />\r\n                </div>\r\n            </div>\r\n        </div>\r\n    )\r\n}\r\n\r\nexport default TopNav\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\components\\legacy_ContentPanel.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\config.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\hooks\\useAutoSave.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\main.jsx","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\sw.js","messages":[],"suppressedMessages":[{"ruleId":"no-undef","severity":2,"message":"'FetchEvent' is not defined.","line":43,"column":29,"nodeType":"Identifier","messageId":"undef","endLine":43,"endColumn":39,"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-undef","severity":2,"message":"'FetchEvent' is not defined.","line":44,"column":1,"nodeType":"Identifier","messageId":"undef","endLine":44,"endColumn":11,"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\utils\\auto_clear_sw.js","messages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":18,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":18,"endColumn":21,"suggestions":[{"fix":{"range":[736,827],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":24,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":24,"endColumn":25,"suggestions":[{"fix":{"range":[1053,1124],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":34,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":34,"endColumn":29,"suggestions":[{"fix":{"range":[1484,1541],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":45,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":45,"endColumn":29,"suggestions":[{"fix":{"range":[1960,2040],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":50,"column":17,"nodeType":"MemberExpression","messageId":"limited","endLine":50,"endColumn":29,"suggestions":[{"fix":{"range":[2377,2458],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":60,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":60,"endColumn":25,"suggestions":[{"fix":{"range":[2722,2792],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":66,"column":57,"nodeType":"Identifier","messageId":"unusedVar","endLine":66,"endColumn":58},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":66,"column":60,"nodeType":"BlockStatement","messageId":"unexpected","endLine":66,"endColumn":63,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[3019,3020],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":70,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":70,"endColumn":25,"suggestions":[{"fix":{"range":[3117,3183],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":73,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":73,"endColumn":25,"suggestions":[{"fix":{"range":[3263,3311],"text":""},"messageId":"removeConsole","data":{"propertyName":"info"},"desc":"Remove the console.info()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":9,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// Auto-clean service worker caches and IndexedDB on first controlled load\r\n// This runs client-side in the browser. It attempts to unregister SWs,\r\n// delete CacheStorage entries, clear IndexedDB databases, and clear local/session storage.\r\nexport async function autoClearSWOnce() {\r\n    try {\r\n        if (!('serviceWorker' in navigator)) return;\r\n\r\n        const FLAG = 'frm_sw_cleanup_done_v1';\r\n        if (localStorage.getItem(FLAG)) return;\r\n\r\n        // Only run if the page is controlled by a service worker (likely stale)\r\n        if (!navigator.serviceWorker.controller) {\r\n            // still mark as done to avoid running repeatedly\r\n            localStorage.setItem(FLAG, '1');\r\n            return;\r\n        }\r\n\r\n        console.info('[AUTO-CLEAN] Detected active Service Worker ??cleaning caches and storage.');\r\n\r\n        // Unregister service workers\r\n        try {\r\n            const regs = await navigator.serviceWorker.getRegistrations();\r\n            await Promise.all(regs.map(r => r.unregister().catch(() => { })));\r\n            console.info('[AUTO-CLEAN] serviceWorker registrations unregistered.');\r\n        } catch (e) {\r\n            console.warn('[AUTO-CLEAN] Failed to unregister service workers', e);\r\n        }\r\n\r\n        // Clear Cache Storage\r\n        try {\r\n            if ('caches' in window) {\r\n                const keys = await caches.keys();\r\n                await Promise.all(keys.map(k => caches.delete(k).catch(() => { })));\r\n                console.info('[AUTO-CLEAN] CacheStorage cleared:', keys);\r\n            }\r\n        } catch (e) {\r\n            console.warn('[AUTO-CLEAN] Failed to clear CacheStorage', e);\r\n        }\r\n\r\n        // Clear IndexedDB databases (where supported)\r\n        try {\r\n            if ('databases' in indexedDB) {\r\n                const dbs = await indexedDB.databases();\r\n                await Promise.all(dbs.map(d => indexedDB.deleteDatabase(d.name).catch(() => { })));\r\n                console.info('[AUTO-CLEAN] IndexedDB databases deleted:', dbs.map(d => d.name));\r\n            } else {\r\n                // Fallback: attempt to delete common names used by Pyodide/emscripten\r\n                const candidates = ['pyodide', 'emscripten-archives', 'idb-filesystem', 'file_storage'];\r\n                await Promise.all(candidates.map(n => indexedDB.deleteDatabase(n).catch(() => { })));\r\n                console.info('[AUTO-CLEAN] IndexedDB fallback delete attempted for candidates.');\r\n            }\r\n        } catch (e) {\r\n            console.warn('[AUTO-CLEAN] Failed to clear IndexedDB', e);\r\n        }\r\n\r\n        // Clear local/session storage\r\n        try {\r\n            localStorage.clear();\r\n            sessionStorage.clear();\r\n            console.info('[AUTO-CLEAN] localStorage and sessionStorage cleared.');\r\n        } catch (e) {\r\n            console.warn('[AUTO-CLEAN] Failed to clear storage', e);\r\n        }\r\n\r\n        // Mark as done so this only runs once per client\r\n        try { localStorage.setItem(FLAG, '1'); } catch (e) { }\r\n\r\n        // Optionally reload to ensure fresh assets are fetched\r\n        try {\r\n            console.info('[AUTO-CLEAN] Reloading page to load fresh assets.');\r\n            window.location.reload(true);\r\n        } catch (e) {\r\n            console.info('[AUTO-CLEAN] Reload skipped.', e);\r\n        }\r\n\r\n    } catch (err) {\r\n        console.warn('[AUTO-CLEAN] Unexpected error', err);\r\n    }\r\n}\r\n\r\nexport default autoClearSWOnce;\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\utils\\error-handler.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\utils\\matplotlib-handler.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\utils\\performance.js","messages":[],"suppressedMessages":[{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":56,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":56,"endColumn":16,"suggestions":[{"fix":{"range":[1136,1224],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":154,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":154,"endColumn":18,"suggestions":[{"fix":{"range":[2948,2972],"text":""},"messageId":"removeConsole","data":{"propertyName":"group"},"desc":"Remove the console.group()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":155,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":155,"endColumn":16,"suggestions":[{"fix":{"range":[2978,3015],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":156,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":156,"endColumn":16,"suggestions":[{"fix":{"range":[3021,3068],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":157,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":157,"endColumn":16,"suggestions":[{"fix":{"range":[3074,3124],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":158,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":158,"endColumn":16,"suggestions":[{"fix":{"range":[3130,3174],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":159,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":159,"endColumn":16,"suggestions":[{"fix":{"range":[3180,3224],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":160,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":160,"endColumn":21,"suggestions":[{"fix":{"range":[3230,3248],"text":""},"messageId":"removeConsole","data":{"propertyName":"groupEnd"},"desc":"Remove the console.groupEnd()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":163,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":163,"endColumn":18,"suggestions":[{"fix":{"range":[3271,3295],"text":""},"messageId":"removeConsole","data":{"propertyName":"group"},"desc":"Remove the console.group()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":166,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":166,"endColumn":20,"suggestions":[{"fix":{"range":[3409,3465],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":169,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":169,"endColumn":21,"suggestions":[{"fix":{"range":[3488,3506],"text":""},"messageId":"removeConsole","data":{"propertyName":"groupEnd"},"desc":"Remove the console.groupEnd()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":209,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":209,"endColumn":18,"suggestions":[{"fix":{"range":[4386,4452],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":217,"column":9,"nodeType":"MemberExpression","messageId":"limited","endLine":217,"endColumn":20,"suggestions":[{"fix":{"range":[4713,4775],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":231,"column":7,"nodeType":"MemberExpression","messageId":"limited","endLine":231,"endColumn":18,"suggestions":[{"fix":{"range":[5153,5185],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}],"suppressions":[{"kind":"directive","justification":""}]}],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\utils\\pyodide-loader.js","messages":[{"ruleId":"no-unused-vars","severity":1,"message":"'SCIPY_STUB' is defined but never used.","line":2,"column":10,"nodeType":"Identifier","messageId":"unusedVar","endLine":2,"endColumn":20,"suggestions":[{"messageId":"removeVar","data":{"varName":"SCIPY_STUB"},"fix":{"range":[39,50],"text":""},"desc":"Remove unused variable 'SCIPY_STUB'."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":98,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":98,"endColumn":16,"suggestions":[{"fix":{"range":[4016,4082],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":110,"column":18,"nodeType":"Identifier","messageId":"unusedVar","endLine":110,"endColumn":19},{"ruleId":"no-unused-vars","severity":1,"message":"'e' is defined but never used.","line":133,"column":63,"nodeType":"Identifier","messageId":"unusedVar","endLine":133,"endColumn":64},{"ruleId":"no-empty","severity":2,"message":"Empty block statement.","line":133,"column":66,"nodeType":"BlockStatement","messageId":"unexpected","endLine":133,"endColumn":69,"suggestions":[{"messageId":"suggestComment","data":{"type":"block"},"fix":{"range":[5496,5497],"text":" /* empty */ "},"desc":"Add comment inside empty block statement."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":137,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":137,"endColumn":24,"suggestions":[{"fix":{"range":[5583,5631],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":270,"column":5,"nodeType":"MemberExpression","messageId":"limited","endLine":270,"endColumn":16,"suggestions":[{"fix":{"range":[10078,10143],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":294,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":294,"endColumn":24,"suggestions":[{"fix":{"range":[11033,11113],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]},{"ruleId":"no-console","severity":1,"message":"Unexpected console statement. Only these console methods are allowed: warn, error.","line":307,"column":13,"nodeType":"MemberExpression","messageId":"limited","endLine":307,"endColumn":24,"suggestions":[{"fix":{"range":[11657,11718],"text":""},"messageId":"removeConsole","data":{"propertyName":"log"},"desc":"Remove the console.log()."}]}],"suppressedMessages":[],"errorCount":1,"fatalErrorCount":0,"warningCount":8,"fixableErrorCount":0,"fixableWarningCount":0,"source":"// pyodide-loader.js (Book2)\r\nimport { SCIPY_STUB, BASE_ENV_SETUP, PYMOO_SHIM, QUANTLIB_SHIM, PANDAS_DATAREADER_SHIM, SCIPY_RVS_SHIM, DATASET_SHIM, MCINT_SHIM } from './python-shims';\r\n\r\nlet pyodideInstance = null;\r\nlet initializationPromise = null;\r\n\r\nclass SmoothProgress {\r\n    constructor(onProgress) {\r\n        this.onProgress = onProgress;\r\n        this.current = 0;\r\n        this.target = 0;\r\n        this.message = '';\r\n        this.interval = null;\r\n    }\r\n\r\n    start() {\r\n        if (this.interval) return;\r\n        this.interval = setInterval(() => {\r\n            if (this.current < this.target) {\r\n                const diff = this.target - this.current;\r\n                const dynamicStep = diff > 20 ? 3.5 : (diff > 5 ? 1.5 : 0.5);\r\n                this.current = Math.min(this.current + dynamicStep, this.target);\r\n                this.onProgress(Math.floor(this.current), this.message);\r\n            } else if (this.target < 99) {\r\n                this.current = Math.min(this.current + 0.08, 99.9);\r\n                this.onProgress(Math.floor(this.current), this.message);\r\n            }\r\n        }, 100);\r\n    }\r\n\r\n    update(target, message) {\r\n        this.target = target;\r\n        if (message) this.message = message;\r\n    }\r\n\r\n    async yieldToUI() {\r\n        return new Promise(resolve => setTimeout(resolve, 30));\r\n    }\r\n\r\n    finish(message = 'Ready!') {\r\n        if (this.interval) clearInterval(this.interval);\r\n        this.current = 100;\r\n        this.onProgress(100, message);\r\n    }\r\n}\r\n\r\nasync function ensurePyodideScript() {\r\n    if (window.loadPyodide) return;\r\n    return new Promise((resolve, reject) => {\r\n        const script = document.createElement('script');\r\n        script.src = 'https://cdn.jsdelivr.net/pyodide/v0.26.4/full/pyodide.js';\r\n        script.onload = () => resolve();\r\n        script.onerror = () => reject(new Error('Failed to load Pyodide script'));\r\n        document.head.appendChild(script);\r\n    });\r\n}\r\n\r\n// Dataset Registry: Maps chapter IDs (lowercase) to their required files\r\n// Files are expected to be at: public/data/datasets/${chapterId}/${filename}\r\n// And will be mounted to: /data/${displayPath} (preserving original structure for compatibility)\r\nconst DATASET_REGISTRY = {\r\n    'b2_ch1': [{ filename: 'SPX_Option.csv', displayPath: 'B2_Ch1/SPX_Option.csv' }],\r\n    'b2_ch4': [\r\n        { filename: 'BankTeleCompaign.csv', displayPath: 'B2_Ch4/BankTeleCompaign.csv' },\r\n        { filename: 'HazardRate.csv', displayPath: 'B2_Ch4/HazardRate.csv' },\r\n        { filename: 'LassoRegrData.csv', displayPath: 'B2_Ch4/LassoRegrData.csv' },\r\n        { filename: 'MultiLrRegrData.csv', displayPath: 'B2_Ch4/MultiLrRegrData.csv' },\r\n        { filename: 'PolyRegrData.csv', displayPath: 'B2_Ch4/PolyRegrData.csv' },\r\n        { filename: 'RidgeRegrData.csv', displayPath: 'B2_Ch4/RidgeRegrData.csv' },\r\n        { filename: 'WTI.csv', displayPath: 'B2_Ch4/WTI.csv' },\r\n        { filename: 'outliersimpact.csv', displayPath: 'B2_Ch4/outliersimpact.csv' }\r\n    ],\r\n    'b2_ch9': [{ filename: 'cs-training.csv', displayPath: 'B2_Ch9/cs-training.csv' }],\r\n    'b2_ch11': [\r\n        { filename: 'Data_portfolio_1.xlsx', displayPath: 'B2_Ch11/Data_portfolio_1.xlsx' },\r\n        { filename: 'Data_portfolio_2.xlsx', displayPath: 'B2_Ch11/Data_portfolio_2.xlsx' }\r\n    ],\r\n    'b2_ch12': [\r\n        { filename: 'Data_portfolio_1.xlsx', displayPath: 'B2_Ch12/Data_portfolio_1.xlsx' },\r\n        { filename: 'Data_portfolio_2.xlsx', displayPath: 'B2_Ch12/Data_portfolio_2.xlsx' }\r\n    ]\r\n};\r\n\r\n/**\r\n * Lazy load datasets for a specific chapter\r\n * @param {Object} pyodide - Pyodide instance\r\n * @param {string} chapterId - Chapter ID (e.g., 'b2_ch4')\r\n */\r\nexport async function loadChapterDatasets(pyodide, chapterId) {\r\n    if (!pyodide || !chapterId) return;\r\n\r\n    // Normalize chapterId just in case\r\n    const normalizedId = chapterId.toLowerCase();\r\n    const files = DATASET_REGISTRY[normalizedId];\r\n\r\n    if (!files || files.length === 0) return;\r\n\r\n    console.log(`[Dataset] Checking datasets for ${normalizedId}...`);\r\n\r\n    for (const file of files) {\r\n        const { filename, displayPath } = file;\r\n        const virtualPath = `/data/${displayPath}`;\r\n\r\n        // Check if file already exists in Pyodide FS\r\n        try {\r\n            if (pyodide.FS.analyzePath(virtualPath).exists) {\r\n                // console.log(`[Dataset] ${virtualPath} already exists. Skipping.`);\r\n                continue;\r\n            }\r\n        } catch (e) {\r\n            // Path analysis failed, proceed to load\r\n        }\r\n\r\n        try {\r\n            // Fetch from public/data/datasets/${chapterId}/${filename}\r\n            const fetchUrl = `${import.meta.env.BASE_URL}data/datasets/${normalizedId}/${filename}`;\r\n            const response = await fetch(fetchUrl);\r\n\r\n            if (!response.ok) {\r\n                if (response.status === 404) console.warn(`[Dataset] File not found: ${fetchUrl}`);\r\n                continue;\r\n            }\r\n\r\n            const arrayBuffer = await response.arrayBuffer();\r\n            const data = new Uint8Array(arrayBuffer);\r\n\r\n            // Ensure directory exists for the virtual path\r\n            const dir = virtualPath.substring(0, virtualPath.lastIndexOf('/'));\r\n            const dirs = dir.split('/').filter(p => p);\r\n            let currentPath = '';\r\n            for (const d of dirs) {\r\n                currentPath += '/' + d;\r\n                try { pyodide.FS.mkdir(currentPath); } catch (e) { }\r\n            }\r\n\r\n            pyodide.FS.writeFile(virtualPath, data);\r\n            console.log(`[Dataset] Loaded: ${virtualPath}`);\r\n\r\n        } catch (err) {\r\n            console.error(`[Dataset] Failed to load ${filename}:`, err);\r\n        }\r\n    }\r\n}\r\n\r\n/**\r\n * Initialize Pyodide with progress tracking\r\n * @param {Function} onProgress - Callback for progress updates\r\n */\r\n/**\r\n * Initialize Light-weight Pyodide (Core Only)\r\n * @param {Function} onProgress - Callback for progress updates\r\n */\r\nexport async function loadPyodide(onProgress) {\r\n    if (pyodideInstance) {\r\n        if (onProgress) onProgress(100, 'Ready');\r\n        return pyodideInstance;\r\n    }\r\n    if (initializationPromise) return initializationPromise;\r\n\r\n    initializationPromise = (async () => {\r\n        const smoother = new SmoothProgress(onProgress);\r\n        smoother.start();\r\n\r\n        try {\r\n            smoother.update(10, '甇??? Python ?渲陌??(v0.26.4)...');\r\n            await ensurePyodideScript();\r\n\r\n            let pyodide = null;\r\n            let retries = 3;\r\n            while (retries > 0) {\r\n                try {\r\n                    const indexURL = 'https://cdn.jsdelivr.net/pyodide/v0.26.4/full/';\r\n                    pyodide = await window.loadPyodide({ indexURL });\r\n                    break;\r\n                } catch (e) {\r\n                    console.warn(`Failed to load Pyodide (attempts left: ${retries - 1}):`, e);\r\n                    retries--;\r\n                    if (retries === 0) throw e;\r\n                    await new Promise(resolve => setTimeout(resolve, 1000));\r\n                }\r\n            }\r\n\r\n            smoother.update(30, '撘???摰?嚗迤?冽炎?交?唳摮憓?..')\r\n            await smoother.yieldToUI();\r\n\r\n            // Setup IDBFS for persistence\r\n            try {\r\n                pyodide.FS.mkdir('/mnt');\r\n                pyodide.FS.mount(pyodide.FS.filesystems.IDBFS, {}, '/mnt');\r\n                // Correctly handle callback-based syncfs\r\n                await new Promise((resolve, reject) => {\r\n                    pyodide.FS.syncfs(true, (err) => {\r\n                        if (err) reject(err);\r\n                        else resolve();\r\n                    });\r\n                });\r\n            } catch (e) {\r\n                console.warn('IDBFS mount skipped:', e);\r\n            }\r\n\r\n            smoother.update(50, '? ?詨?嚗迤?其?頛蝷?蝞芋蝯?(Numpy, Pandas)...')\r\n            await smoother.yieldToUI();\r\n\r\n            // 1. Load ONLY Lightweight Core Packages for Fast Startup\r\n            // Note: matplotlib is included as it is essential for almost all pages\r\n            const corePackages = ['numpy', 'pandas', 'matplotlib', 'micropip'];\r\n\r\n            for (const pkg of corePackages) {\r\n                await pyodide.loadPackage(pkg);\r\n            }\r\n\r\n            smoother.update(80, '?? ?蔭嚗迤?刻??亦憓??銝?..')\r\n            await smoother.yieldToUI();\r\n\r\n            smoother.update(90, '?? ?詨?嚗迤?冽釣??Python ?詨捆?批???..')\r\n            await pyodide.runPythonAsync(`\r\nimport sys\r\nimport os\r\nimport builtins\r\nimport js\r\n\r\n# Ensure data directory exists\r\nif not os.path.exists('/data'):\r\n    os.makedirs('/data')\r\nsys.path.append('/data')\r\n\r\ndef custom_input(prompt = \"\"):\r\n    try:\r\n        val = js.window.prompt(prompt if prompt else \"\")\r\n        return val if val is not None else \"\"\r\n    except Exception: return \"\"\r\nbuiltins.input = custom_input\r\n            `);\r\n            await smoother.yieldToUI();\r\n\r\n            // Load essential shims\r\n            await Promise.all([\r\n                pyodide.runPythonAsync(BASE_ENV_SETUP),\r\n                pyodide.runPythonAsync(DATASET_SHIM),\r\n                // Lightweight stubs for immediate use\r\n                // pyodide.runPythonAsync(SCIPY_STUB) // We will load full scipy later\r\n            ]);\r\n\r\n            pyodideInstance = pyodide;\r\n            initializationPromise = null;\r\n            smoother.finish('?箇??詨?頛摰?嚗?);\r\n            return pyodide;\r\n        } catch (error) {\r\n            initializationPromise = null;\r\n            if (smoother.interval) clearInterval(smoother.interval);\r\n            console.error('Failed to load Pyodide:', error);\r\n            throw error;\r\n        }\r\n    })();\r\n\r\n    return initializationPromise;\r\n}\r\n\r\n// Track heavy loading state\r\nlet isHeavyLoaded = false;\r\nlet heavyLoadingPromise = null;\r\n\r\n/**\r\n * Background load heavy packages (SciPy, Scikit-learn, etc.)\r\n * This should be called after the UI is interactive.\r\n */\r\nexport async function preloadHeavyPackages(pyodide) {\r\n    if (isHeavyLoaded || heavyLoadingPromise) return heavyLoadingPromise;\r\n\r\n    console.log(\"?? [Background] Starting heavy package preload...\");\r\n\r\n    heavyLoadingPromise = (async () => {\r\n        try {\r\n            // Heavy Core Packages\r\n            // scipy, statsmodels, scikit-learn are LARGE\r\n            const heavyCore = ['scipy', 'statsmodels', 'scikit-learn'];\r\n\r\n            for (const pkg of heavyCore) {\r\n                // console.log(`[Background] Loading ${pkg}...`);\r\n                await pyodide.loadPackage(pkg);\r\n            }\r\n\r\n            // Pip Packages (some descend on scipy/numpy)\r\n            const pipPackages = ['seaborn', 'numpy-financial', 'pandas-datareader', 'pyodide-http'];\r\n\r\n            // Ensure micropip is ready (it should be from core)\r\n            const micropip = pyodide.pyimport('micropip');\r\n\r\n            for (const pkg of pipPackages) {\r\n                // console.log(`[Background] Installing ${pkg}...`);\r\n                await micropip.install(pkg);\r\n            }\r\n\r\n            console.log(\"??[Background] Heavy packages loaded. Applying advanced shims...\");\r\n\r\n            // Apply Advanced Shims that depend on heavy packages\r\n            await Promise.all([\r\n                // Overwrite stubs with real modules if needed, or apply specific patches\r\n                pyodide.runPythonAsync(SCIPY_RVS_SHIM),\r\n                pyodide.runPythonAsync(PYMOO_SHIM),\r\n                pyodide.runPythonAsync(QUANTLIB_SHIM),\r\n                pyodide.runPythonAsync(PANDAS_DATAREADER_SHIM),\r\n                pyodide.runPythonAsync(MCINT_SHIM)\r\n            ]);\r\n\r\n            isHeavyLoaded = true;\r\n            console.log(\"??[Background] Full Python Environment Ready.\");\r\n\r\n        } catch (e) {\r\n            console.error(\"?? [Background] Heavy package preload failed:\", e);\r\n            // Don't throw, just log. allow retry later via ensureDependencies\r\n            heavyLoadingPromise = null;\r\n        }\r\n    })();\r\n\r\n    return heavyLoadingPromise;\r\n}\r\n\r\n/**\r\n * Get the initialized Pyodide instance\r\n */\r\nexport function getPyodide() {\r\n    return pyodideInstance;\r\n}\r\n\r\n/**\r\n * Execute Python code with a timeout\r\n * @param {Object} pyodide - Pyodide instance\r\n * @param {string} code - Python code to execute\r\n * @param {number} timeout - Timeout in milliseconds (default 30000)\r\n */\r\nexport async function runPythonWithTimeout(pyodide, code, timeout = 30000) {\r\n    let timeoutId;\r\n    const timeoutPromise = new Promise((_, reject) => {\r\n        timeoutId = setTimeout(() => {\r\n            reject(new Error(`Execution timed out after ${timeout / 1000} seconds`));\r\n        }, timeout);\r\n    });\r\n\r\n    try {\r\n        const result = await Promise.race([\r\n            pyodide.runPythonAsync(code),\r\n            timeoutPromise\r\n        ]);\r\n        return result;\r\n    } finally {\r\n        clearTimeout(timeoutId);\r\n    }\r\n}\r\n\r\n/**\r\n * Cleanup Pyodide memory and state\r\n * @param {Object} pyodide - Pyodide instance\r\n */\r\nexport async function cleanupPyodide(pyodide) {\r\n    if (!pyodide) return;\r\n    try {\r\n        await pyodide.runPythonAsync(`\r\nimport gc\r\nimport matplotlib.pyplot as plt\r\nplt.close('all')\r\ngc.collect()\r\n        `);\r\n    } catch {\r\n        // Silent fail for cleanup\r\n    }\r\n}\r\n","usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\utils\\python-shims.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]},{"filePath":"C:\\Users\\benit\\Desktop\\FRM MATLAB\\Python\\pwa_Book2_python\\src\\utils\\storage.js","messages":[],"suppressedMessages":[],"errorCount":0,"fatalErrorCount":0,"warningCount":0,"fixableErrorCount":0,"fixableWarningCount":0,"usedDeprecatedRules":[]}]
