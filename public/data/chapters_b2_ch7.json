{
  "id": "b2_ch7",
  "title": "第7章：希臘字母",
  "number": 7,
  "content": {
    "intro": {
      "title": "第 7 章：希臘字母 - 重點詳解 (Detail)",
      "roadmap": {
        "guide": "希臘字母衡量的選擇權價格對各種市場參數（標的價格、時間、波動率、利率）的敏感性。它們是動態避險與資產組合風險管理的靈魂。本章透過三維視覺化技術，揭示了希臘字母如何在不同市場維度下演化。",
        "objectives": "*   理解各希臘字母的金融意義與計算公式（BSM 解析解）。\n*   學會利用 Python 的 `mpl_toolkits.mplot3d` 繪製風險曲面。\n*   掌握希臘字母在建構 Delta-Neutral 或 Gamma-Neutral 組合中的實務運用。",
        "topics": "*   7.1 希臘字母 (The Greeks) 概論\n*   7.2 Delta：價格變動敏感度\n*   7.3 Gamma：Delta 的變動率與凸性相關\n*   7.4 Theta：時間流逝對價值的影響\n*   7.5 Vega：波動率敏感度分析\n*   7.6 Rho：利率風險度量"
      },
      "value": {
        "practical": "*   **實務場景**：在期權做市商業務中，監控總持倉的 Gamma 暴露以防止價格大幅跳空帶來的損失。\n*   **考試重點**：理解希臘字母之間的關係，例如 $Theta$ 與 $Gamma$ 之間的權衡（Trade-off）。",
        "theory": "希臘字母提供了對期權風險的局部線性逼近（Taylor Series Expansion）。視覺化三維曲面能直觀地展示風險因子在不同價格與時間區間內的劇烈變動。",
        "further_reading": "*   Taleb (1997) Dynamic Hedging."
      },
      "implementation": {
        "python": "*   **希臘字母實作**：使用 BSM 解析解公式實作 `blsdelta()`, `blsgamma()` 等函數。\n*   **三維曲面**：利用 `mpl_toolkits.mplot3d` 與 `numpy.meshgrid` 繪製交互式三維風險曲面。\n*   **數值校驗**：使用數值微分驗證解析解的準確性。",
        "logic": "*   Taylor Series Expansion：局部線性逼近風險。\n*   Meshgrid：生成參數網格進行曲面視覺化。",
        "scenarios": "| 腳本名稱 | 核心使命 |\n| :--- | :--- |\n| **B2_Ch7_1.py** | **[三維]** 實作 Black-Scholes Delta 隨參數變動的三維視覺化分析。 |\n| **B2_Ch7_2.py** | **[三維]** 實作 Black-Scholes Gamma 的三維曲面繪製與分析。 |\n| **B2_Ch7_3.py** | **[三維]** 實作 Black-Scholes Theta 時間衰減特徵的三維呈現。 |\n| **B2_Ch7_4.py** | **[三維]** 實作 Black-Scholes Vega 波動率敏感度分析與圖表繪製。 |\n| **B2_Ch7_5.py** | **[三維]** 實作 Black-Scholes Rho 利率敏感度分析，視覺化風險曲面。 |"
      }
    },
    "body": {
      "7.1": "### 7.1 希臘字母 (The Greeks) 概論：風險的一階與二階剖析\n希臘字母是量化風險管理的核心語言。它們衡量期權價格對各個市場敏感因子（標的價格、時間、波動率、利率）的偏導數。資深從業人員將希臘字母視為「局部線性逼近」(Taylor Series Expansion)，用於精確對沖特定維度的風險暴露。\n\n#### 專家定義：泰勒級數與全微分風險\n期權價格變化 $\\delta V$ 可以近似分解為各個希臘字母的貢獻：\n\n$$\n  \\delta V \\approx \\Delta \\delta S + \\frac{1}{2} \\Gamma \\delta S^2 + \\Theta \\delta t + \\mathcal{V} \\delta \\sigma + \\rho \\delta r\n$$\n\n#### 專家決策矩陣：核心希臘字母的決策維境\n資深分析師必須根據頭寸配置選取最關心的風險指標：\n\n| 希臘字母 | 敏感因子 | 核心使命 | 實務警示 |\n| :--- | :--- | :--- | :--- |\n| **Delta ($\\Delta$)** | 標的價格 $S$ | 定向風險管理、動態對沖率 | 隨價格變動而變，需頻繁重新平衡 |\n| **Gamma ($\\Gamma$)** | Delta 的變化率 | 衡量對沖成本與凸性風險 | **二階威脅**：ATM 期權临近到期時會劇烈跳動 |\n| **Theta ($\\Theta$)** | 時間流逝 $t$ | 衡量時間價值衰減 (Time Decay) | **時間的代價**：買方每日損失的權利金 |\n| **Vega ($\\mathcal{V}$)** | 隱含波動率 $\\sigma$ | 衡量市場動盪風險 | 並非 BSM 公式本身的變量，是外加的敏感度 |\n| **Rho ($\\rho$)** | 無風險利率 $r$ | 衡量貨幣成本風險 | 長期期權 (LEAPS) 對 Rho 極度敏感 |\n\n> [!IMPORTANT]\n> 在生產端對沖系統中（見 `B2_Ch7_1.py`），資深開發者會使用 `scipy.stats.norm.pdf` 來計算 Gamma。必須意識到，追求「Delta Neutral」的同時，往往會暴露在「Gamma Risk」下。當市場發生跳空（Gapping）時，僅靠 Delta 對沖無法保護資產，必須透過 Gamma 對沖來彌補非線性損失。\n\n#### 7.1 資深從業人員行動清單 (Action Items)\n執行希臘字母分析前，必須確認：\n- **單位標準化校準**：確保 Vega 輸出為波动率變動 1% 時的價值變化，而非變動 1.0 (100%)。\n- **時間基數匹配**：Theta 通常以「每日」為單位（除以 365 或 252），必須與報價系統一致。\n- **三維風險曲面稽核**：繪製 $S$ 與 $T$ 共同作用下的希臘字母曲面，識別隱藏的風險高峰（如 Pin Risk）。",
      "7.2": "### 7.2 Delta：資產組合的動態對沖率\nDelta ($\\Delta$) 衡量期權價格對標的資產價格的一階導數。它代表了當標的價格變動 1 單位時，期權價值的預期變動。在資深風險管理中，Delta 是建構「無方向性」策略（Delta Neutral）的權威輸入。\n\n#### 技術核心：BSM 解析解\n對於不支付股息的歐式看漲期權，$d_1$ 的正態累計分佈即為 Delta：\n\n$$\n  \\Delta_{call} = e^{-qT} N(d_1), \\quad \\Delta_{put} = -e^{-qT} N(-d_1)\n$$\n\n#### 專家決策矩陣：Delta 的多維解讀\n資深分析師不應僅將其視為導數，應理解其多重角色：\n\n| 解讀維度 | 行為特徵 | 實務應用 |\n| :--- | :--- | :--- |\n| **對沖比率** | 每持有一份期權需對沖的標的數量 | 建構 Delta-Neutral 組合以消除定向風險 |\n| **行權機率** | 趨近於期權到期在價內 (ITM) 的近似機率 | 用於快速評估策略成功率（雖非精確機率） |\n| **獲利等效性** |Delta 為 0.5 代表期權漲跌速度是標的之 50% | 決定期權頭寸與現貨頭寸的替代關係 |\n\n> [!IMPORTANT]\n> 在三維視覺化中（見 `B2_Ch7_1.py`），Delta 隨價格 $S$ 與時間 $T$ 的演化呈現出 S 型曲線。對於 ITM 看漲期權，Delta 隨到期日接近而收斂至 1。資深交易員必須在期權步入深度價內時，及時調整現貨對沖頭寸，否則將產生「超載對沖」風險。\n\n#### 7.2 資深從業人員行動清單 (Action Items)\n執行 Delta 管理時，必須落實：\n- **動態再平衡審計**：根據標的波動率設定 Delta 重新平衡的「容忍區間」(Trigger Band)，平衡對沖成本與殘餘風險。\n- **現金與資產對齊**：確保 Delta 計算已考量合約乘數，將「名目 Delta」轉換為真實需對沖的資產數量。\n- **跨產品 Delta 分解**：在多資產組合中，將各期權 Delta 依據標的相關性進行分類彙總。",
      "7.3": "### 7.3 Gamma：對沖成本與凸性風險的二階度量\nGamma ($\\Gamma$) 衡量 Delta 隨標的價格變動的速率，即期權價格對價格的二階導數。它是風險管理中最危險的希臘字母，因為它決定了對沖頭寸失效的速度。高 Gamma 代表你必須頻繁且昂貴地調整對沖頭寸。\n\n#### 技術核心：Gamma 的解析表達\nGamma 對於看漲與看跌期權是相同的，且永遠為正（對於多頭期權）：\n\n$$\n  \\Gamma = \\frac{e^{-qT} n(d_1)}{S_0 \\sigma \\sqrt{T}}\n$$\n\n其中 $n(d_1)$ 是標準正態分佈的機率密度函數 (PDF)。\n\n#### 專家決策矩陣：Gamma 暴露與 Pin Risk\n資深計量師必須識別 Gamma 爆炸的特定區間：\n\n| 參數變動 | Gamma 表現 | 實務影響 |\n| :--- | :--- | :--- |\n| **標的價格趨向 $K$** | 達到峰值（平值 ATM） | 此時 Delta 變動最快，對沖成本最高 |\n| **時間趨向 0 (到期)** | **極度尖銳化** | 產生「引腳風險」(Pin Risk)，Delta 可能在 0 與 1 間劇烈擺動 |\n| **波動率 $\\sigma$ 下降** | Gamma 變得更陡峭 | 範圍縮減但強度增加，模型穩定性變差 |\n\n> [!IMPORTANT]\n> 在 Python 繪製的 Gamma 曲面中（見 `B2_Ch7_2.py`），ATM 點在到期日前會形成一道尖銳的山脊。資深做市商必須在到期前及時平倉 ATM 頭寸，或利用 Gamma Neutral 策略（加入另一份期權）來抵消這一二階風險，而非僅靠標的對沖。\n\n#### 7.3 資深從業人員行動清單 (Action Items)\n執行 Gamma 監控前，必須確認：\n- **對沖頻率校準**：在 Gamma 高峰期（ATM 且 T 短），提高 Delta 對沖的頻率或縮減對沖觸發閾值。\n- **負 Gamma 防禦**：針對空頭期權持有者（賣方），確保具備足夠的保證金以應對 Gamma 導致的對沖虧損加速擴大。\n- **組合 Gamma 排列**：彙總所有到期支柱的 Gamma，識別全投資組合中最脆弱的價格區間。",
      "7.4": "### 7.4 Theta：時間價值衰減與「買方租金」\nTheta ($\\Theta$) 衡量期權價值隨時間流逝的變化率，代表了期權持有者每日承擔的持倉成本。資深分析師將其視為「時間的代價」。對於期權買方，Theta 幾乎總是負值，意味著如果不發生價格波動，你將每天損失金錢。\n\n#### 技術核心：Theta 的解析特徵\n對於歐式看漲期權，其解析表達式較為複雜，反映了 $dt$ 項在 BSM 方程中的權重：\n\n$$\n  \\Theta_{call} = -\\frac{S_0 \\sigma e^{-qT} n(d_1)}{2\\sqrt{T}} - r K e^{-rT} N(d_2) + q S_0 e^{-qT} N(d_1)\n$$\n\n#### 專家決策矩陣：Theta 與 Gamma 的對沖關係 (The Trade-off)\n在 Delta-Neutral 組合中，Theta 與 Gamma 呈現互補關係，這是 BSM 偏微分方程的物理本質：\n\n| 策略地位 | Gamma 符號 | Theta 符號 | 金融含義 |\n| :--- | :--- | :--- | :--- |\n| **買入期權 (Long)** | 正 (+) | 負 (-) | **付租金買爆發**：付出時間衰減以換取價格凸性收益 |\n| **賣出期權 (Short)** | 負 (-) | 正 (+) | **收租金擔突發**：賺取利息但面臨價格跳空的巨大風險 |\n| **理想平衡** | 平衡對沖 | 接近零 | 策略趨向於 Gamma-Theta 中性 |\n\n> [!IMPORTANT]\n> 在生產端監控 Theta 曲面時（見 `B2_Ch7_3.py`），會發現 ATM 期權在到期前夕 Theta 衰減最為劇烈（呈現自由落體狀）。資深交易員絕不在到期前三天持有大量 ATM 多頭，因為這無異於在一個「熔化的冰塊」上博弈。\n\n#### 7.4 資深從業人員行動清單 (Action Items)\n執行 Theta 分析時，必須落實：\n- **每日利潤歸因 (P&L Attribution)**：檢查每日盈利是否與預期的 Theta 收入或支出一致。\n- **到期壓力監控**：標識出即將到期的頭寸，評估 Theta 加速衰減對保證金佔用的影響。\n- **週末風險校準**：針對休市日（週六日），預提兩天的 Theta 損失估計，防止週一開市後的價值突降。",
      "7.5": "### 7.5 Vega：波動率敏感度與情緒性風險\nVega ($\\mathcal{V}$) 衡量期權價格對隱含波動率 (IV) 變化的敏感度。它代表了市場「情緒不穩定性」對價值的買賣成本。資深從業人員利用 Vega 來對沖突發的市場恐慌或在波動率均值回歸中獲取收益。\n\n#### 技術核心：Vega 的一致性\n與 Gamma 類似，看漲與看跌期權的 Vega 是完全相同的。在 BSM 框架下其定義為：\n\n$$\n  \\mathcal{V} = S_0 e^{-qT} n(d_1) \\sqrt{T}\n$$\n\n#### 專家決策矩陣：Vega 的期限結構與行為特徵\n波動率敏感度隨到期時間的長短呈現截然不同的特性：\n\n| 期限長短 | Vega 強度 | 實務決策 |\n| :--- | :--- | :--- |\n| **長期期權 (LEAPS)** | **極高** | 受 IV 波動影響極大，即使標的價格不動，IV 上升也會大幅推升價值 |\n| **短期期權** | 較低 | 價值主要受 Delta 與 Gamma 驅動，對 IV 變動相對遲鈍 |\n| **平值 (ATM)** | 達到峰值 | 是波動率交易（如 Straddles）的核心操作區域 |\n\n> [!TIP]\n> 在視覺化曲面中（見 `B2_Ch7_4.py`），Vega 呈現出「鐘形長嶺」。資深分析師會意識到，IV 的變動往往是全市場連動的。因此，必須建立「Vega 總敞口限制」，防止在波動率劇烈回歸（Volatility Crush）時出現全組合性的估值崩潰。\n\n#### 7.5 資深從業人員行動清單 (Action Items)\n執行 Vega 管理前，必須確認：\n- **IV 變動規模校正**：確保 Vega 計算是基於 1% 的 IV 變動（即 0.01）。\n- **波動率偏斜耦合**：在計算 Vega 時，考量標的價格變動對 IV 的反向拉動效應（即 Vanna 效應）。\n- **壓力測試 (Volatility Shock)**：模擬 IV 突然上升 10%（如 30% 變 40%）時，組合淨值的負面衝擊程度。",
      "7.6": "### 7.6 Rho：利率風險與資金成本度量\nRho ($\\rho$) 衡量期權價格對無風險利率 $r$ 變化的敏感度。雖然在短期個股期權交易中常被忽略，但在長期期權、結構性債券及大負債資產配置中，Rho 是決定利息支出與持有價值平衡的核心參數。\n\n#### 技術核心：Rho 的解析解\n對於看漲期權，Rho 與行權價和到期時間呈正相關：\n\n$$\n  \\rho_{call} = K T e^{-rT} N(d_2), \\quad \\rho_{put} = -K T e^{-rT} N(-d_2)\n$$\n\n#### 專家決策矩陣：Rho 的方向性影響\n利率變動對買權與賣權的影響是完全對立的：\n\n| 變量變動 | 看漲期權 (Call) 價值 | 看跌期權 (Put) 價值 |\n| :--- | :--- | :--- |\n| **利率 $r$ 上升** | **上升** (因未來支付現金的現值下降) | **下降** (因未來收到現金的現值下降) |\n| **到期日 $T$ 增加** | Rho 的絕對值增加 | Rho 的絕對值增加 |\n| **深度 ITM** | Rho 值達到最高 | Rho 絕對值達到最高 |\n\n> [!IMPORTANT]\n> 在三維視覺化中（見 `B2_Ch7_5.py`），Rho 的曲面最為平緩，但隨著 $T$ 增加具備顯著的槓桿效應。資深交易員在處理跨年度的 LEAPS 合約或複雜的場外互換期權 (Swaptions) 時，必須將 Rho 納入 Hedges 矩陣，並利用利率期貨進行專門的 Rho 對沖。\n\n#### 7.6 資深從業人員行動清單 (Action Items)\n執行 Rho 監控時，必須落實：\n- **利率曲線對位**：確保 $r$ 使用的是期權到期日對應的 OIS 或國債即期利率。\n- **貨幣敞口分離**：在外匯期權中，分別計算本幣 Rho 與外幣 Rho（即 Phi）。\n- **久期 (Duration) 對標**：將 Rho 轉換為「Delta 盈虧平衡利率變動量」，以評估模型對貨幣政策變動的脆弱性。\n\n#### 核心技術結論\n希臘字母是複雜衍生品的「風險分光儀」。透過將價格變動分解為 Delta、Gamma、Vega、Theta 與 Rho，我們不僅能理解風險，更能將「不確定性」轉化為「可管理的參數矩陣」。"
    },
    "examples": [
      {
        "id": "ex1",
        "title": "7.1 Black-Scholes Delta 三維視覺化",
        "filename": "B2_Ch7_1.py",
        "code": "# B2_Ch7_1.py\n\n###############\n# Prepared by Ran An, Wei Lu, and Feng Zhang\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 2  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nfrom mpl_toolkits.mplot3d import axes3d\nimport matplotlib.tri as tri\nfrom matplotlib import cm\n\n# Delta of European option\n\ndef blsdelta(St, K, tau, r, vol, q):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    Delta_call  = norm.cdf(d1, loc=0, scale=1)*math.exp(-q*tau)\n    Delta_put   = -norm.cdf(-d1, loc=0, scale=1)*math.exp(-q*tau)\n    return Delta_call, Delta_put\n    \n\n# Initialize\ntau_array = np.linspace(0.01,1,30);\nSt_array  = np.linspace(20,80,30);\ntau_Matrix,St_Matrix = np.meshgrid(tau_array,St_array)\n\nDelta_call_Matrix = np.empty(np.size(tau_Matrix))\nDelta_put_Matrix  = np.empty(np.size(tau_Matrix))\n\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \nq = 0;     # continuously compounded yield of the underlying asset\n\nblsdelta_vec = np.vectorize(blsdelta)\nDelta_call_Matrix, Delta_put_Matrix = blsdelta_vec(St_Matrix, K, tau_Matrix, r, vol, q)\n\n#%% plot Delta surface of European call option\n\nplt.close('all')\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Delta_call_Matrix)\n\nplt.show()\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call Delta')\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Delta_call_Matrix.min(),Delta_call_Matrix.max())\n\n#%% Call Delta surface projected to tau-Gamma\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Delta_call_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\n\nax.contour(tau_Matrix, St_Matrix, Delta_call_Matrix, levels = 20, zdir='y', \\\n            offset=St_array.max(), cmap=cm.coolwarm)\n\nax.set_label('Call Theta')\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Delta_call_Matrix.min(),Delta_call_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call Delta')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\n#%% Call Delta surface projected to tau-Gamma\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Delta_call_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\n\nax.contour(tau_Matrix, St_Matrix, Delta_call_Matrix, levels = 20, zdir='x', \\\n           offset=0, cmap=cm.coolwarm)\n# ax.contour(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, zdir='x', \\\n#            cmap=cm.coolwarm)\n\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Delta_call_Matrix.min(),Delta_call_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call Delta')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\n#%% Call Delta surface projected to tau-S\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Delta_call_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\n\nax.contour(tau_Matrix, St_Matrix, Delta_call_Matrix, levels = 20, zdir='z', \\\n           offset=0, cmap=cm.coolwarm)\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Delta_call_Matrix.min(),Delta_call_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call Delta')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\n#%% contour map of Call Delta\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(tau_Matrix, St_Matrix, Delta_call_Matrix, levels = np.linspace(0,1,21), cmap=\"RdBu_r\")\n\nfig.colorbar(cntr2, ax=ax)\n\nax.contour(tau_Matrix, St_Matrix, Delta_call_Matrix, levels = [0.5], colors='k', linewidths = 2)\n\nplt.subplots_adjust(hspace=0.5)\nplt.show()\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n#%% Compare Call vs Put Delta\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Delta_call_Matrix)\nax.plot_wireframe(tau_Matrix, St_Matrix, Delta_put_Matrix,color = 'r')\n\nplt.show()\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Delta')\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Delta_put_Matrix.min(),Delta_call_Matrix.max())\n"
      },
      {
        "id": "ex2",
        "title": "7.2 Black-Scholes Gamma 三維視覺化",
        "filename": "B2_Ch7_2.py",
        "code": "# B2_Ch7_2.py\n\n###############\n# Prepared by Ran An, Wei Lu, and Feng Zhang\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 2  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nfrom mpl_toolkits.mplot3d import axes3d\nfrom matplotlib import cm\n\n# Gamma of European option\n\ndef blsgamma(St, K, tau, r, vol, q):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n        \n    Gamma = math.exp(-q*tau)*norm.pdf(d1)/St/vol/math.sqrt(tau);\n\n    return Gamma\n    \n\n# Initialize\ntau_array = np.linspace(0.1,1,30);\nSt_array  = np.linspace(20,80,30);\ntau_Matrix,St_Matrix = np.meshgrid(tau_array,St_array)\n\nDelta_call_Matrix = np.empty(np.size(tau_Matrix))\nDelta_put_Matrix  = np.empty(np.size(tau_Matrix))\n\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \nq = 0;     # continuously compounded yield of the underlying asset\n\nblsgamma_vec = np.vectorize(blsgamma)\nGamma_Matrix = blsgamma_vec(St_Matrix, K, tau_Matrix, r, vol, q)\n\n#%% plot Gamma surface of European call option\n\nplt.close('all')\n\n# Normalize to [0,1]\nnorm = plt.Normalize(Gamma_Matrix.min(), Gamma_Matrix.max())\ncolors = cm.coolwarm(norm(Gamma_Matrix))\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\nsurf = ax.plot_surface(tau_Matrix, St_Matrix, Gamma_Matrix,\n    facecolors=colors, shade=False)\nsurf.set_facecolor((0,0,0,0))\nplt.show()\n\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Gamma')\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Gamma_Matrix.min(),Gamma_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\n#%% Gamma surface projected to S-Gamma\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Gamma_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\n\nax.contour(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, zdir='x', \\\n           offset=0, cmap=cm.coolwarm)\n# ax.contour(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, zdir='x', \\\n#            cmap=cm.coolwarm)\n    \n# cbar = fig.colorbar(csetf, ax=ax,orientation='horizontal')\ncbar.set_label('Call Gamma')\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Gamma_Matrix.min(),Gamma_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Gamma')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\n#%% Gamma surface projected to tau-Gamma\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Gamma_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\n\nax.contour(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, zdir='y', \\\n            offset=St_array.max(), cmap=cm.coolwarm)\n\n# cbar = fig.colorbar(csetf, ax=ax,orientation='horizontal')\ncbar.set_label('Call Gamma')\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Gamma_Matrix.min(),Gamma_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Gamma')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\n#%% Gamma surface projected to tau-S\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Gamma_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\n\nax.contour(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, zdir='z', \\\n            offset=Gamma_Matrix.min(), cmap=cm.coolwarm)\n\n# cbar = fig.colorbar(csetf, ax=ax,orientation='horizontal')\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Gamma_Matrix.min(),Gamma_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Gamma')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\n#%% contour map\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(tau_Matrix, St_Matrix, Gamma_Matrix, levels = 20, cmap=\"RdBu_r\")\n\nfig.colorbar(cntr2, ax=ax)\n\nplt.show()\n\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Underlying price')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n"
      },
      {
        "id": "ex3",
        "title": "7.3 範例程式",
        "filename": "B2_Ch7_3.py",
        "code": "# B2_Ch7_3.py\n\n###############\n# Prepared by Ran An, Wei Lu, and Feng Zhang\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 2  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nfrom mpl_toolkits.mplot3d import axes3d\nimport matplotlib.tri as tri\nfrom matplotlib import cm\n\n# Delta of European option\n\ndef blstheta(St, K, tau, r, vol, q):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n    \n    Theta_call = -math.exp(-q*tau)*St*norm.pdf(d1)*vol/2/math.sqrt(tau) - \\\n        r*K*math.exp(-r*tau)*norm.cdf(d2) + q*St*math.exp(-q*tau)*norm.cdf(d1)\n        \n    Theta_put = -math.exp(-q*tau)*St*norm.pdf(-d1)*vol/2/math.sqrt(tau) + \\\n        r*K*math.exp(-r*tau)*norm.cdf(-d2) - q*St*math.exp(-q*tau)*norm.cdf(-d1)\n    return Theta_call, Theta_put\n\n# Initialize\ntau_array = np.linspace(0.05,1,30);\nSt_array  = np.linspace(20,80,30);\ntau_Matrix,St_Matrix = np.meshgrid(tau_array,St_array)\n\nTheta_call_Matrix = np.empty(np.size(tau_Matrix))\nTheta_put_Matrix  = np.empty(np.size(tau_Matrix))\n\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \nq = 0;     # continuously compounded yield of the underlying asset\n\nblstheta_vec = np.vectorize(blstheta)\nTheta_call_Matrix, Theta_put_Matrix = blstheta_vec(St_Matrix, K, tau_Matrix, r, vol, q)\n\n#%% plot Theta surface of European call option\n\nplt.close('all')\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Theta_call_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\ncsetf = ax.contourf(tau_Matrix, St_Matrix, Theta_call_Matrix, levels = 15, zdir='z', \\\n                    offset=Theta_call_Matrix.min(), cmap=cm.coolwarm)\nax.contour(tau_Matrix, St_Matrix, Theta_call_Matrix, levels = 15, zdir='x', \\\n           offset=0, cmap=cm.coolwarm)\nax.contour(tau_Matrix, St_Matrix, Theta_call_Matrix, levels = 15, zdir='y', \\\n           offset=St_array.max(), cmap=cm.coolwarm)\n\ncbar = fig.colorbar(csetf, ax=ax,orientation='horizontal')\ncbar.set_label('Call Theta')\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Theta_call_Matrix.min(),Theta_call_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call Theta')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\n\n#%% plot Theta surface of European put option\n\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Theta_put_Matrix, color = [0.5,0.5,0.5], linewidth=0.5)\ncsetf = ax.contourf(tau_Matrix, St_Matrix, Theta_put_Matrix, levels = 15, zdir='z', \\\n                    offset=Theta_put_Matrix.min(), cmap=cm.coolwarm)\nax.contour(tau_Matrix, St_Matrix, Theta_put_Matrix, levels = 15, zdir='x', \\\n           offset=0, cmap=cm.coolwarm)\nax.contour(tau_Matrix, St_Matrix, Theta_put_Matrix, levels = 15, zdir='y', \\\n           offset=St_array.max(), cmap=cm.coolwarm)\n\ncbar = fig.colorbar(csetf, ax=ax, orientation='horizontal')\n# cbar.set_label('Put Theta')\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Theta_put_Matrix.min(),Theta_put_Matrix.max())\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Put Theta')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.tight_layout()\nplt.show()\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(tau_Matrix, St_Matrix, Theta_put_Matrix, levels = 20, cmap=\"RdBu_r\")\nax.contour(tau_Matrix, St_Matrix, Theta_put_Matrix, levels = 0,colors='k', linewidths = 2)\n\nfig.colorbar(cntr2, ax=ax)\nplt.show()\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\nax.set_ylim(St_array.min(), St_array.max())\n\n#%% Compare Call vs Put Theta\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Theta_call_Matrix)\nax.plot_wireframe(tau_Matrix, St_Matrix, Theta_put_Matrix,color = 'r')\n\nplt.show()\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Theta')\n\nax.xaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.yaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\nax.zaxis._axinfo[\"grid\"].update({\"linewidth\":0.25, \"linestyle\" : \":\"})\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Theta_call_Matrix.min(),Theta_put_Matrix.max())\n\n"
      },
      {
        "id": "ex4",
        "title": "7.4 範例程式",
        "filename": "B2_Ch7_4.py",
        "code": "# B2_Ch7_4.py\n\n###############\n# Prepared by Ran An, Wei Lu, and Feng Zhang\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 2  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nfrom mpl_toolkits.mplot3d import axes3d\nimport matplotlib.tri as tri\nfrom matplotlib import cm\n\n# Vega of European option\n\ndef blsvega(St, K, tau, r, vol, q):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    \n    Vega = St*math.exp(-q*tau)*norm.pdf(d1)*math.sqrt(tau)\n    return Vega\n\n# Initialize\ntau_array = np.linspace(0.1,1,30);\nSt_array  = np.linspace(20,80,30);\ntau_Matrix,St_Matrix = np.meshgrid(tau_array,St_array)\n\nDelta_call_Matrix = np.empty(np.size(tau_Matrix))\nDelta_put_Matrix  = np.empty(np.size(tau_Matrix))\n\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \nq = 0;     # continuously compounded yield of the underlying asset\n\nblsvega_vec = np.vectorize(blsvega)\nVega_Matrix = blsvega_vec(St_Matrix, K, tau_Matrix, r, vol, q)\n\n#%% plot Vega surface of European call/put option\n\nplt.close('all')\n\n# Normalize to [0,1]\nnorm = plt.Normalize(Vega_Matrix.min(), Vega_Matrix.max())\ncolors = cm.coolwarm(norm(Vega_Matrix))\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\nsurf = ax.plot_surface(tau_Matrix, St_Matrix, Vega_Matrix,\n    facecolors=colors, shade=False)\nsurf.set_facecolor((0,0,0,0))\nplt.show()\n\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call/Put Vega')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\n\n\nfig = plt.figure()\nax = fig.add_subplot(111, projection='3d')\nX, Y, Z = axes3d.get_test_data(0.05)\ncset = ax.contour(tau_Matrix, St_Matrix, Vega_Matrix, cmap=cm.coolwarm,levels = 20)\nax.clabel(cset, fontsize=9, inline=1)\n\nplt.show()\nplt.tight_layout()\nax.set_xlabel('Time to maturity')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call/Put Vega')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\n\n# contour map\n\nfig, ax = plt.subplots()\n\ncntr2 = ax.contourf(tau_Matrix, St_Matrix, Vega_Matrix, levels = 20, cmap=\"RdBu_r\")\n\nfig.colorbar(cntr2, ax=ax)\n# ax.set(xlim=(-2, 2), ylim=(-2, 2))\n# plt.subplots_adjust(hspace=0.5)\nplt.show()\n\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\n\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\nax.set_ylim(St_array.min(), St_array.max())\n"
      },
      {
        "id": "ex5",
        "title": "7.5 範例程式",
        "filename": "B2_Ch7_5.py",
        "code": "# B2_Ch7_5.py\n\n###############\n# Prepared by Ran An, Wei Lu, and Feng Zhang\n# Editor-in-chief: Weisheng Jiang, and Sheng Tu\n# Book 2  |  Financial Risk Management with Python\n# Published and copyrighted by Tsinghua University Press\n# Beijing, China, 2021\n###############\n\nimport math\nimport numpy as np\nimport matplotlib as mpl\nimport matplotlib.pyplot as plt\nfrom scipy.stats import norm\nfrom mpl_toolkits.mplot3d import axes3d\nfrom matplotlib import cm\n\n# Gamma of European option\n\ndef blsrho(St, K, tau, r, vol, q):\n    '''\n    St: current price of underlying asset\n    K:  strike price\n    tau: time to maturity\n    r: annualized risk-free rate\n    vol: annualized asset price volatility\n    '''\n    \n    d1 = (math.log(St / K) + (r - q + 0.5 * vol ** 2)\\\n          *tau) / (vol * math.sqrt(tau));\n    d2 = d1 - vol*math.sqrt(tau);\n        \n    Rho_call = K*tau*math.exp(-r*tau)*norm.cdf(d2);\n    Rho_put = -K*tau*math.exp(-r*tau)*norm.cdf(-d2);\n    \n    return Rho_call, Rho_put\n    \n\n# Initialize\ntau_array = np.linspace(0.1,1,30);\nSt_array  = np.linspace(20,80,30);\ntau_Matrix,St_Matrix = np.meshgrid(tau_array,St_array)\n\nVega_call_Matrix = np.empty(np.size(tau_Matrix))\nVega_put_Matrix  = np.empty(np.size(tau_Matrix))\n\nK = 50;    # strike price\nr = 0.03;  # risk-free rate\nvol = 0.5; # volatility \nq = 0;     # continuously compounded yield of the underlying asset\n\nblsrho_vec = np.vectorize(blsrho)\nRho_call_Matrix, Rho_put_Matrix = blsrho_vec(St_Matrix, K, tau_Matrix, r, vol, q)\n\n#%% plot Rho surface of European call option\n\nplt.close('all')\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Rho_call_Matrix)\ncset = ax.contour(tau_Matrix, St_Matrix, Rho_call_Matrix, zdir='z',\\\n                  offset=Rho_call_Matrix.min(), cmap=cm.coolwarm)\ncset = ax.contour(tau_Matrix, St_Matrix, Rho_call_Matrix, zdir='x',\\\n                  offset=0, cmap=cm.coolwarm)\ncset = ax.contour(tau_Matrix, St_Matrix, Rho_call_Matrix, zdir='y',\\\n                  offset=St_array.max(), cmap=cm.coolwarm)\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Rho_call_Matrix.min(),Rho_call_Matrix.max())\n\n\nplt.tight_layout()\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Call Rho')\nax.set_facecolor('white')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.show()\n\n#%% plot Rho surface of European put option\n\nfig = plt.figure()\nax = fig.gca(projection='3d')\n\nax.plot_wireframe(tau_Matrix, St_Matrix, Rho_put_Matrix)\ncset = ax.contour(tau_Matrix, St_Matrix, Rho_put_Matrix, zdir='z', \\\n                  offset=Rho_put_Matrix.min(), cmap=cm.coolwarm)\ncset = ax.contour(tau_Matrix, St_Matrix, Rho_put_Matrix, zdir='x', \\\n                  offset=0, cmap=cm.coolwarm)\ncset = ax.contour(tau_Matrix, St_Matrix, Rho_put_Matrix, zdir='y', \\\n                  offset=St_array.max(), cmap=cm.coolwarm)\n\nax.set_xlim(0, 1)\nax.set_ylim(St_array.min(), St_array.max())\nax.set_zlim(Rho_put_Matrix.min(),Rho_put_Matrix.max())\n\nplt.tight_layout()\nax.set_xlabel('Time to maturity (year)')\nax.set_ylabel('Underlying price')\nax.set_zlabel('Put Rho')\nplt.rcParams[\"font.family\"] = \"Times New Roman\"\nplt.rcParams[\"font.size\"] = \"10\"\n\nplt.show()\n"
      }
    ]
  }
}