/**
 * å°‡ Python éŒ¯èª¤è½‰æ›ç‚ºå‹å–„çš„éŒ¯èª¤è¨Šæ¯
 * @param {Error} error - Python éŒ¯èª¤ç‰©ä»¶
 * @returns {string} å‹å–„çš„éŒ¯èª¤è¨Šæ¯
 */
export function formatPythonError(error) {
  const message = error.message || String(error)

  // å¸¸è¦‹éŒ¯èª¤çš„å‹å–„æç¤º
  const errorPatterns = [
    {
      pattern: /NameError: name '(.+)' is not defined/,
      format: (match) => `âŒ è®Šæ•¸éŒ¯èª¤ï¼š'${match[1]}' æœªå®šç¾©

ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š
â€¢ è®Šæ•¸åç¨±æ‹¼å¯«éŒ¯èª¤
â€¢ è®Šæ•¸å°šæœªå®£å‘Šå°±ä½¿ç”¨
â€¢ æ³¨æ„ Python å€åˆ†å¤§å°å¯«ï¼ˆä¾‹å¦‚ï¼šdata å’Œ Data æ˜¯ä¸åŒçš„ï¼‰

ğŸ”§ å»ºè­°ï¼š
â€¢ æª¢æŸ¥è®Šæ•¸åç¨±æ˜¯å¦æ­£ç¢º
â€¢ ç¢ºèªè®Šæ•¸æ˜¯å¦å·²ç¶“å®šç¾©
â€¢ ä½¿ç”¨ print() æª¢æŸ¥è®Šæ•¸å€¼`
    },
    {
      pattern: /ModuleNotFoundError: No module named '(.+)'/,
      format: (match) => `âŒ æ¨¡çµ„éŒ¯èª¤ï¼šæ‰¾ä¸åˆ°æ¨¡çµ„ '${match[1]}'

ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š
â€¢ æ¨¡çµ„åç¨±æ‹¼å¯«éŒ¯èª¤
â€¢ è©²æ¨¡çµ„ä¸æ”¯æ´ç€è¦½å™¨ç’°å¢ƒ
â€¢ æ¨¡çµ„å°šæœªè¼‰å…¥

ğŸ”§ æ”¯æ´çš„æ¨¡çµ„ï¼š
â€¢ numpy - æ•¸å€¼è¨ˆç®—
â€¢ pandas - è³‡æ–™åˆ†æ
â€¢ matplotlib - è³‡æ–™è¦–è¦ºåŒ–
â€¢ scikit-learn - æ©Ÿå™¨å­¸ç¿’ (sklearn)
â€¢ scipy - ç§‘å­¸è¨ˆç®—
â€¢ statsmodels - çµ±è¨ˆæ¨¡å‹
â€¢ plotly - äº’å‹•å¼åœ–è¡¨
â€¢ arch - GARCH æ¨¡å‹
â€¢ tabulate / prettytable - è¡¨æ ¼æ ¼å¼åŒ–

å¦‚éœ€ä½¿ç”¨å…¶ä»–æ¨¡çµ„ï¼Œè«‹ç¢ºèªæ˜¯å¦æ”¯æ´ Pyodideã€‚`
    },
    {
      pattern: /SyntaxError/,
      format: () => `âŒ èªæ³•éŒ¯èª¤

ğŸ’¡ å¸¸è¦‹åŸå› ï¼š
â€¢ æ‹¬è™Ÿã€å¼•è™Ÿæœªé…å°
â€¢ ç¸®æ’ä¸æ­£ç¢º
â€¢ å†’è™Ÿéºæ¼ï¼ˆifã€forã€def ç­‰å¾Œé¢éœ€è¦å†’è™Ÿï¼‰
â€¢ ä½¿ç”¨äº†ä¸­æ–‡æ¨™é»ç¬¦è™Ÿ

ğŸ”§ å»ºè­°ï¼š
â€¢ ä»”ç´°æª¢æŸ¥æ¯ä¸€è¡Œçš„èªæ³•
â€¢ ç¢ºä¿æ‹¬è™Ÿ ()ã€[] å’Œ {} éƒ½æœ‰é…å°
â€¢ ç¢ºä¿å­—ä¸²çš„å¼•è™Ÿé…å°ï¼ˆ' æˆ– "ï¼‰`
    },
    {
      pattern: /IndentationError/,
      format: () => `âŒ ç¸®æ’éŒ¯èª¤

ğŸ’¡ Python ä½¿ç”¨ç¸®æ’ä¾†è¡¨ç¤ºç¨‹å¼ç¢¼å€å¡Š

ğŸ”§ å»ºè­°ï¼š
â€¢ ä½¿ç”¨ä¸€è‡´çš„ç¸®æ’ï¼ˆå»ºè­° 4 å€‹ç©ºæ ¼ï¼‰
â€¢ ä¸è¦æ··ç”¨ç©ºæ ¼å’Œ Tab
â€¢ æª¢æŸ¥ ifã€forã€def ç­‰èªå¥å¾Œçš„ç¸®æ’
â€¢ ç¢ºä¿åŒä¸€å€å¡Šçš„ç¨‹å¼ç¢¼ç¸®æ’ç›¸åŒ`
    },
    {
      pattern: /TypeError: (.+)/,
      format: (match) => `âŒ å‹åˆ¥éŒ¯èª¤ï¼š${match[1]}
    
ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š
â€¢ å°ä¸æ”¯æ´çš„å‹åˆ¥é€²è¡Œæ“ä½œ
â€¢ å‡½æ•¸åƒæ•¸å‹åˆ¥ä¸æ­£ç¢º
â€¢ å˜—è©¦å° None é€²è¡Œæ“ä½œ
    
ğŸ”§ å»ºè­°ï¼š
â€¢ æª¢æŸ¥è®Šæ•¸çš„å‹åˆ¥ï¼ˆä½¿ç”¨ type() å‡½æ•¸ï¼‰
â€¢ ç¢ºèªå‡½æ•¸åƒæ•¸æ˜¯å¦æ­£ç¢º
â€¢ æª¢æŸ¥æ˜¯å¦æœ‰è®Šæ•¸ç‚º None`
    },
    {
      pattern: /IndexError: (.+)/,
      format: (match) => `âŒ ç´¢å¼•éŒ¯èª¤ï¼š${match[1]}

ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š
â€¢ å­˜å–è¶…å‡ºç¯„åœçš„ç´¢å¼•
â€¢ åˆ—è¡¨æˆ–é™£åˆ—ç‚ºç©º

ğŸ”§ å»ºè­°ï¼š
â€¢ æª¢æŸ¥ç´¢å¼•å€¼æ˜¯å¦åœ¨æœ‰æ•ˆç¯„åœå…§
â€¢ ä½¿ç”¨ len() æª¢æŸ¥åˆ—è¡¨é•·åº¦
â€¢ æ³¨æ„ Python ç´¢å¼•å¾ 0 é–‹å§‹`
    },
    {
      pattern: /KeyError: (.+)/,
      format: (match) => `âŒ éµå€¼éŒ¯èª¤ï¼š${match[1]}

ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š
â€¢ å­—å…¸ä¸­ä¸å­˜åœ¨è©²éµå€¼
â€¢ DataFrame ä¸­ä¸å­˜åœ¨è©²æ¬„ä½

ğŸ”§ å»ºè­°ï¼š
â€¢ ä½¿ç”¨ .get() æ–¹æ³•å®‰å…¨åœ°å­˜å–å­—å…¸
â€¢ ä½¿ç”¨ .keys() æŸ¥çœ‹æ‰€æœ‰å¯ç”¨çš„éµ
â€¢ æª¢æŸ¥éµåæ˜¯å¦æ‹¼å¯«æ­£ç¢º`
    },
    {
      pattern: /ValueError: (.+)/,
      format: (match) => `âŒ æ•¸å€¼éŒ¯èª¤ï¼š${match[1]}
    
ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š
â€¢ å‡½æ•¸æ¥æ”¶åˆ°ä¸åˆæ³•çš„åƒæ•¸å€¼
â€¢ å‹åˆ¥è½‰æ›å¤±æ•—
â€¢ æ•¸å­¸é‹ç®—çš„å€¼ä¸åˆæ³•
    
ğŸ”§ å»ºè­°ï¼š
â€¢ æª¢æŸ¥å‡½æ•¸åƒæ•¸çš„å€¼æ˜¯å¦åˆç†
â€¢ ç¢ºèªè³‡æ–™æ ¼å¼æ˜¯å¦æ­£ç¢º
â€¢ æª¢æŸ¥æ˜¯å¦æœ‰ç©ºå€¼æˆ–ç•°å¸¸å€¼`
    },
    {
      pattern: /ZeroDivisionError/,
      format: () => `âŒ é™¤ä»¥é›¶éŒ¯èª¤

ğŸ’¡ åŸå› ï¼š
â€¢ å˜—è©¦é™¤ä»¥é›¶

ğŸ”§ å»ºè­°ï¼š
â€¢ åœ¨é™¤æ³•å‰æª¢æŸ¥é™¤æ•¸æ˜¯å¦ç‚ºé›¶
â€¢ ä½¿ç”¨ if èªå¥é¿å…é™¤ä»¥é›¶
â€¢ æª¢æŸ¥è³‡æ–™ä¸­æ˜¯å¦æœ‰é›¶å€¼`
    },
    {
      pattern: /ImportError:?\s*(.*)/,
      format: (match) => `âŒ åŒ¯å…¥éŒ¯èª¤${match[1] ? 'ï¼š' + match[1].trim() : ''}

ğŸ’¡ å¯èƒ½çš„åŸå› ï¼š
â€¢ æ¨¡çµ„åŒ¯å…¥å¤±æ•—
â€¢ æ¨¡çµ„å…§éƒ¨éŒ¯èª¤
â€¢ Pyodide ç’°å¢ƒæœªå®Œå…¨åˆå§‹åŒ–

ğŸ”§ å»ºè­°ï¼š
â€¢ ç¢ºèªæ¨¡çµ„åç¨±æ­£ç¢º
â€¢ æª¢æŸ¥æ˜¯å¦æ”¯æ´è©²æ¨¡çµ„
â€¢ é‡æ–°æ•´ç†é é¢å¾Œå†è©¦ä¸€æ¬¡
â€¢ æŸ¥çœ‹ç€è¦½å™¨ä¸»æ§å° (F12) äº†è§£å®Œæ•´éŒ¯èª¤è¨Šæ¯`
    }
  ]

  // å˜—è©¦åŒ¹é…éŒ¯èª¤æ¨¡å¼
  for (const { pattern, format } of errorPatterns) {
    const match = message.match(pattern)
    if (match) {
      return format(match)
    }
  }

  // é è¨­éŒ¯èª¤è¨Šæ¯
  return `âŒ åŸ·è¡ŒéŒ¯èª¤

${message}

ğŸ’¡ æç¤ºï¼š
â€¢ ä»”ç´°é–±è®€éŒ¯èª¤è¨Šæ¯
â€¢ æª¢æŸ¥ç¨‹å¼ç¢¼èªæ³•å’Œé‚è¼¯
â€¢ ä½¿ç”¨ print() é™¤éŒ¯
â€¢ åƒè€ƒç¯„ä¾‹ç¨‹å¼ç¢¼

ğŸ”§ é™¤éŒ¯æŠ€å·§ï¼š
â€¢ é€è¡ŒåŸ·è¡Œç¨‹å¼ç¢¼æ‰¾å‡ºå•é¡Œ
â€¢ ä½¿ç”¨ print() è¼¸å‡ºè®Šæ•¸å€¼
â€¢ ç°¡åŒ–ç¨‹å¼ç¢¼ï¼Œé€æ­¥æ¸¬è©¦`
}

/**
 * æª¢æŸ¥éŒ¯èª¤æ˜¯å¦ç‚ºç¶²è·¯éŒ¯èª¤
 */
export function isNetworkError(error) {
  return error.message.includes('fetch') ||
    error.message.includes('network') ||
    error.message.includes('Failed to load')
}

/**
 * æª¢æŸ¥éŒ¯èª¤æ˜¯å¦ç‚º Pyodide è¼‰å…¥éŒ¯èª¤
 */
export function isPyodideLoadError(error) {
  return error.message.includes('pyodide') ||
    error.message.includes('loadPyodide')
}
